(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b9acb64"],{"6c6a":function(t,e,n){"use strict";n.r(e);n("a9e3");var a=n("7a23"),r=function(t){return Object(a["H"])("data-v-03625797"),t=t(),Object(a["F"])(),t},c={class:"swap"},s={class:"swap-item"},o=r((function(){return Object(a["k"])("div",{class:"title"},"USDT 兑换 KTT",-1)})),u=r((function(){return Object(a["k"])("span",{class:"sympol"},"KTT",-1)})),l={class:"flex-between"},i={class:"price-desc"},d=Object(a["m"])("需要： "),p=Object(a["m"])(" USDT"),b={class:"price-desc"},m=Object(a["m"])("余额： "),w=Object(a["m"])(" USDT"),O={class:"button-box"},j=Object(a["m"])("兑换"),f=Object(a["m"])("授权USDT"),k={class:"swap-item"},g=r((function(){return Object(a["k"])("div",{class:"title"},"KTT 兑换 KTM",-1)})),h=r((function(){return Object(a["k"])("span",{class:"sympol"},"KTT",-1)})),v={class:"flex-between"},x={class:"price-desc"},A=Object(a["m"])("获得: "),C=Object(a["m"])(" KTM"),y={class:"price-desc"},K=Object(a["m"])("余额: "),T=Object(a["m"])(" KTT"),B={class:"button-box"},R=Object(a["m"])("兑换"),U=Object(a["m"])("授权KTT");function V(t,e,n,r,V,F){var M=Object(a["L"])("HeadTop"),D=Object(a["L"])("van-field"),N=Object(a["L"])("van-button");return Object(a["E"])(),Object(a["j"])("div",c,[Object(a["n"])(M,{title:"兑换",isShowTop:!0,isSubHeader:!1}),Object(a["k"])("div",s,[o,Object(a["n"])(D,{modelValue:t.swapKttAmount,"onUpdate:modelValue":[e[0]||(e[0]=function(e){return t.swapKttAmount=e}),t.getOutAmount],center:"",clearable:"",label:"",placeholder:"请输入兑换数量"},{extra:Object(a["V"])((function(){return[u]})),_:1},8,["modelValue","onUpdate:modelValue"]),Object(a["k"])("div",l,[Object(a["k"])("div",i,[d,Object(a["k"])("span",null,Object(a["P"])(t.usdtAmount),1),p]),Object(a["k"])("div",b,[m,Object(a["k"])("span",null,Object(a["P"])(t.usdtBalance),1),w])]),Object(a["k"])("div",O,[Number(t.usdtAllowance>0)?(Object(a["E"])(),Object(a["h"])(N,{key:0,type:"primary",loading:t.btn.loading,size:"large","loading-text":"兑换中...",block:"",onClick:t.swapByUsdt},{default:Object(a["V"])((function(){return[j]})),_:1},8,["loading","onClick"])):(Object(a["E"])(),Object(a["h"])(N,{key:1,type:"primary",loading:t.btn.loading,size:"large","loading-text":"正在授权...",onClick:t.approveUsdt},{default:Object(a["V"])((function(){return[f]})),_:1},8,["loading","onClick"]))])]),Object(a["k"])("div",k,[g,Object(a["n"])(D,{modelValue:t.swapAmount,"onUpdate:modelValue":[e[1]||(e[1]=function(e){return t.swapAmount=e}),t.getOutKtmAmount],center:"",clearable:"",label:"",placeholder:"请输入兑换数量"},{extra:Object(a["V"])((function(){return[h]})),_:1},8,["modelValue","onUpdate:modelValue"]),Object(a["k"])("div",v,[Object(a["k"])("div",x,[A,Object(a["k"])("span",null,Object(a["P"])(t.ktmAmount),1),C]),Object(a["k"])("div",y,[K,Object(a["k"])("span",null,Object(a["P"])(t.kttBalance),1),T])]),Object(a["k"])("div",B,[Number(t.kttAllowance)>0?(Object(a["E"])(),Object(a["h"])(N,{key:0,color:"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)",type:"primary",loading:t.btn.swaploading,size:"large","loading-text":"兑换中...",block:"",onClick:t.swapKtm},{default:Object(a["V"])((function(){return[R]})),_:1},8,["loading","onClick"])):(Object(a["E"])(),Object(a["h"])(N,{key:1,color:"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)",type:"primary",loading:t.btn.swaploading,size:"large","loading-text":"正在授权...",onClick:t.approveKtt},{default:Object(a["V"])((function(){return[U]})),_:1},8,["loading","onClick"]))])])])}var F=n("5530"),M=n("1da1"),D=(n("96cf"),n("b680"),n("1a2e")),N=n("5502"),_=n("9d56"),S=n("901e"),E=n.n(S),z=n("2ef0"),H=n.n(z),P=n("a1be"),L=n("722f"),I=n("01ea"),J=n("626a"),Q={components:{HeadTop:D["a"]},setup:function(){var t=Object(N["b"])(),e=Object(a["I"])({address:Object(a["f"])((function(){return t.state.accounts[0]})),web3:Object(a["f"])((function(){return t.state.provider})),swapContract:null,usdtContract:null,KttContract:null,KtmContract:null,usdtAllowance:"",kttAllowance:"",usdtBalance:"0.00",kttBalance:"0.00",usdtAmount:"0.00",kttAmount:"0.00",ktmAmount:"0.00",btn:{loading:!1,swaploading:!1},swapKttAmount:"",swapAmount:"",pickerValue:{text:"显示器",value:1},columns:[{text:"显示器",value:1},{text:"主机",value:2},{text:"主播",value:3},{text:"麦克风",value:4},{text:"声卡",value:5}],initContract:function(){e.swapContract=new e.web3.eth.Contract(P,I["a"].swapAddress),e.usdtContract=new e.web3.eth.Contract(L,I["a"].usdtAddress),e.kttContract=new e.web3.eth.Contract(L,I["a"].kttAddress),e.ktmContract=new e.web3.eth.Contract(L,I["a"].ktmAddress),e.initData()},initData:function(){e.getBalance(),e.getUsdtAllowance(),e.getKttAllowance()},getBalance:function(){var t=Object(M["a"])(regeneratorRuntime.mark((function t(){var n,a,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.kttContract.methods.decimals().call();case 2:return n=t.sent,t.next=5,e.usdtContract.methods.decimals().call();case 5:return a=t.sent,t.next=8,e.kttContract.methods.balanceOf(e.address).call();case 8:return r=t.sent,t.next=11,e.usdtContract.methods.balanceOf(e.address).call();case 11:c=t.sent,e.kttBalance=new E.a(r).dividedBy(Math.pow(10,n)).toFixed(2),e.usdtBalance=new E.a(c).dividedBy(Math.pow(10,a)).toFixed(2);case 14:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),getUsdtAllowance:function(){var t=Object(M["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.usdtContract.methods.allowance(e.address,I["a"].swapAddress).call();case 2:n=t.sent,e.usdtAllowance=n;case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),getKttAllowance:function(){var t=Object(M["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.kttContract.methods.allowance(e.address,I["a"].swapAddress).call();case 2:n=t.sent,e.kttAllowance=n;case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),approveUsdt:function(){var t=Object(M["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.btn.loading=!0,t.prev=1,t.next=4,e.usdtContract.methods.approve(I["a"].swapAddress,_["b"]).send({from:e.address});case 4:Object(J["a"])("授权成功"),e.getUsdtAllowance(),e.btn.loading=!1,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),Object(J["a"])("授权失败"),e.btn.loading=!1;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));function n(){return t.apply(this,arguments)}return n}(),approveKtt:function(){var t=Object(M["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.btn.swaploading=!0,t.prev=1,t.next=4,e.kttContract.methods.approve(I["a"].swapAddress,_["b"]).send({from:e.address});case 4:Object(J["a"])("授权成功"),e.getKttAllowance(),e.btn.swaploading=!1,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),Object(J["a"])("授权失败"),e.btn.swaploading=!1;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));function n(){return t.apply(this,arguments)}return n}(),swapByUsdt:function(){var t=Object(M["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapKttAmount){t.next=3;break}return Object(J["a"])("请先输入数量"),t.abrupt("return");case 3:if(!(Number(e.usdtAmount)>Number(e.usdtBalance))){t.next=6;break}return Object(J["a"])("USDT余额不足"),t.abrupt("return");case 6:return e.btn.loading=!0,t.prev=7,t.next=10,e.kttContract.methods.decimals().call();case 10:return n=t.sent,a=new E.a(e.swapKttAmount).multipliedBy(Math.pow(10,n)).toFixed(),t.next=14,e.swapContract.methods.swapByUsdt(a).send({from:e.address});case 14:Object(J["a"])("兑换成功"),e.getBalance(),e.btn.loading=!1,t.next=23;break;case 19:t.prev=19,t.t0=t["catch"](7),Object(J["a"])("兑换失败"),e.btn.loading=!1;case 23:case"end":return t.stop()}}),t,null,[[7,19]])})));function n(){return t.apply(this,arguments)}return n}(),swapKtm:function(){var t=Object(M["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapAmount){t.next=3;break}return Object(J["a"])("请先输入数量"),t.abrupt("return");case 3:if(!(Number(e.swapAmount)>Number(e.kttBalance))){t.next=6;break}return Object(J["a"])("KTT余额不足"),t.abrupt("return");case 6:return e.btn.swaploading=!0,t.next=9,e.kttContract.methods.decimals().call();case 9:return n=t.sent,a=new E.a(e.swapAmount).multipliedBy(Math.pow(10,n)).toFixed(),t.prev=11,t.next=14,e.swapContract.methods.swapKtm(a).send({from:e.address});case 14:Object(J["a"])("兑换成功"),e.initData(),e.btn.swaploading=!1,t.next=23;break;case 19:t.prev=19,t.t0=t["catch"](11),Object(J["a"])("兑换失败"),e.btn.swaploading=!1;case 23:case"end":return t.stop()}}),t,null,[[11,19]])})));function n(){return t.apply(this,arguments)}return n}(),getOutAmount:H.a.throttle(Object(M["a"])(regeneratorRuntime.mark((function t(){var n,a,r,c,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapKttAmount&&0!=Number(e.swapKttAmount)){t.next=2;break}return t.abrupt("return","0.00");case 2:return t.next=4,e.kttContract.methods.decimals().call();case 4:return n=t.sent,a=new E.a(e.swapKttAmount).multipliedBy(Math.pow(10,n)).toFixed(),t.next=8,e.swapContract.methods.getUsdtAmount(a).call();case 8:return r=t.sent,t.next=11,e.usdtContract.methods.decimals().call();case 11:c=t.sent,s=new E.a(r).dividedBy(Math.pow(10,c)).toFixed(2),e.usdtAmount=s;case 14:case"end":return t.stop()}}),t)}))),1e3),getOutKtmAmount:H.a.throttle(Object(M["a"])(regeneratorRuntime.mark((function t(){var n,a,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapAmount&&0!=Number(e.swapAmount)){t.next=3;break}return e.ktmAmount="0.00",t.abrupt("return","0.00");case 3:return t.next=5,e.kttContract.methods.decimals().call();case 5:return n=t.sent,t.next=8,e.ktmContract.methods.decimals().call();case 8:return a=t.sent,r=new E.a(e.swapAmount).multipliedBy(Math.pow(10,n)).toFixed(),t.next=12,e.swapContract.methods.getKtmAmount(r).call();case 12:c=t.sent,e.ktmAmount=new E.a(c).dividedBy(Math.pow(10,a)).toFixed(2);case 14:case"end":return t.stop()}}),t)}))),1e3)});e.address&&e.initContract(),Object(a["T"])((function(){return e.address}),(function(t){t&&e.initContract()}));var n=Object(a["Q"])(e);return Object(F["a"])({},n)}},q=(n("ac59"),n("6b0d")),G=n.n(q);const W=G()(Q,[["render",V],["__scopeId","data-v-03625797"]]);e["default"]=W},8836:function(t,e,n){},ac59:function(t,e,n){"use strict";n("8836")}}]);
//# sourceMappingURL=chunk-3b9acb64.3b18ef33.js.map