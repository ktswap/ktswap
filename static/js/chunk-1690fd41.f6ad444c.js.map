{"version":3,"sources":["webpack:///./src/views/sellMarket/index.vue","webpack:///./src/views/sellMarket/index.vue?3f57","webpack:///./src/views/sellMarket/index.vue?dc4a"],"names":["class","_createElementVNode","style","_createBlock","_component_van_list","loading","_ctx","$event","immediate-check","error","error-text","finished","finished-text","onLoad","_createVNode","_component_HeadTop","title","isShowTop","isSubHeader","_hoisted_3","_component_van_field","center","clearable","label","placeholder","extra","_hoisted_4","_hoisted_5","_toDisplayString","_hoisted_10","Number","_component_van_button","type","size","loading-text","block","onClick","_hoisted_14","_createElementBlock","_Fragment","_renderList","item","index","key","kttAmount","_hoisted_19","_hoisted_20","price","_hoisted_23","_hoisted_26","buyer","substring","length","_hoisted_29","haveSellAmount","_hoisted_32","remainAmount","_hoisted_35","isCancle","ownerAddress","id","_component_van_dialog","show","showConfirmButton","_hoisted_40","_component_van_icon","name","color","_hoisted_41","swaploading","components","HeadTop","setup","store","useStore","data","reactive","address","computed","state","accounts","web3","provider","marketContract","usdtContract","KttContract","usdtAllowance","usdtBalance","usdtAmount","ktmAmount","kttBalance","kttAllowance","config","btn","swapKttAmount","swapAmount","list","orderInfo","page","limit","initContract","eth","Contract","marketAbi","sellMarketAddress","tokenAbi","usdtAddress","kttContract","kttAddress","initData","getBalance","getUsdtAllowance","getKttAllowance","getList","methods","decimals","call","kttDecimals","usdtDecimals","balanceOf","BigNumber","dividedBy","toFixed","allowance","approveUsdt","approve","MaxUint256","send","from","Toast","approveKtt","addBuyRecord","amount","multipliedBy","getUserRecords","info","recordArr","arr","forEach","push","minus","Math","ceil","total","toSell","sellKtt","sell","cancle","getOutAmount","_","throttle","watch","val","refData","toRefs","__exports__","render"],"mappings":"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","file":"static/js/chunk-1690fd41.f6ad444c.js","sourcesContent":["<template>\r\n <van-list v-model:loading=\"loading\" :immediate-check=\"false\" v-model:error=\"error\" error-text=\"请求失败，点击重新加载\" :finished=\"finished\" finished-text=\"没有更多了\" @load=\"onLoad\">\r\n  <div class=\"swap\">\r\n    <HeadTop title=\"卖单市场\" :isShowTop=\"true\" :isSubHeader=\"false\"></HeadTop>\r\n    <div class=\"swap-item\">\r\n        <div class=\"title\">挂卖单</div>\r\n          <van-field\r\n          style=\"margin-bottom: 12px\"\r\n    v-model=\"swapKttAmount\"\r\n    center\r\n    clearable\r\n    label=\"\"\r\n    @update:model-value=\"getOutAmount\"\r\n    placeholder=\"请输入卖出数量\"\r\n  >\r\n    <template #extra>\r\n      <span class=\"sympol\">KTT</span>\r\n    </template>\r\n  </van-field>\r\n    <van-field\r\n    v-model=\"price\"\r\n    center\r\n    clearable\r\n    label=\"\"\r\n    @update:model-value=\"getOutAmount\"\r\n    placeholder=\"请输入单价\"\r\n  >\r\n    <template #extra>\r\n      <span class=\"sympol\">USDT / KTT</span>\r\n    </template>\r\n  </van-field>\r\n  <div class=\"flex-between\">\r\n    <!-- <div class=\"price-desc\">需要： <span>{{usdtAmount}}</span> USDT</div> -->\r\n    <div class=\"price-desc\">余额： <span>{{kttBalance}}</span> KTT</div>\r\n  </div>\r\n  <div style=\"margin-top: -20px\">\r\n   <div class=\"price-desc\">100KTT起步、100的整数倍挂卖</div> \r\n  </div>\r\n  \r\n  <div class=\"button-box\">\r\n     <van-button type=\"primary\" :loading=\"btn.loading\" size=\"large\" loading-text=\"兑换中...\" block v-if=\"Number(kttAllowance > 0)\" @click=\"addBuyRecord\">挂单</van-button>\r\n     <van-button type=\"primary\" :loading=\"btn.loading\" v-else size=\"large\" loading-text=\"正在授权...\" @click=\"approveKtt\">授权KTT</van-button>\r\n  </div>\r\n    </div>\r\n    <div class=\"title-sub\">所有挂单</div>\r\n  \r\n      <div class=\"list-box\">\r\n       <div class=\"item\"  v-show=\"Number(item.kttAmount) > Number(item.haveSellAmount)\" v-for=\"(item, index) in list\" :key=\"index\">\r\n          <div class=\"top flex-middle\">\r\n            <div class=\"top-item flex-item\">\r\n               <div class=\"num\">{{item.kttAmount}}</div>\r\n               <div class=\"desc\">卖出KTT数量</div>\r\n            </div>\r\n            <div class=\"line\"></div>\r\n            <div class=\"top-item flex-item\">\r\n               <div class=\"num yellow\">{{item.price}}USDT</div>\r\n               <div class=\"desc\">价格/KTT</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"bottom\">\r\n            <div class=\"row flex-middle\">\r\n                <div class=\"name\">挂单地址</div>\r\n                <div class=\"value\">{{item.buyer.substring(0, 6) + '......' + item.buyer.substring(item.buyer.length - 6, item.buyer.length)}}</div>\r\n             </div>\r\n             <div class=\"row flex-middle\">\r\n                <div class=\"name\">已卖出数量</div>\r\n                <div class=\"value\">{{item.haveSellAmount}}KTT</div>\r\n             </div>\r\n              <div class=\"row flex-middle\">\r\n                <div class=\"name\">剩余数量</div>\r\n                <div class=\"value\">{{item.remainAmount}}KTT</div>\r\n             </div>\r\n          </div>\r\n           <div class=\"btn-box flex-between\" v-if=\"Number(item.kttAmount) > Number(item.haveSellAmount)\">\r\n               <span></span>\r\n                <van-button v-if=\"!item.isCancle && (item.buyer == address || address == config.ownerAddress)\" type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block @click=\"cancle(item.id)\">取消</van-button>\r\n                <van-button v-if=\"!item.isCancle\" type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block  @click=\"toSell(item)\">买入KTT</van-button>\r\n                <van-button v-if=\"item.isCancle\" type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block >已取消</van-button>\r\n           </div>\r\n       </div>\r\n    </div>\r\n    <van-dialog v-model:show=\"show\" class=\"swap-item\" :showConfirmButton=\"false\" style=\"padding: 0\" :title=\"''\">\r\n          <div class=\"close-box flex-between\">\r\n            <span></span>\r\n            <van-icon @click=\"show=false\" name=\"cross\" color=\"#fff\" size=\"20px\"/>\r\n          </div>\r\n          <van-field\r\n    v-model=\"swapAmount\"\r\n    center\r\n    clearable\r\n    label=\"\"\r\n    placeholder=\"请输入买入数量\"\r\n  >\r\n    <template #extra>\r\n      <span class=\"sympol\">KTT</span>\r\n    </template>\r\n  </van-field>\r\n  <div class=\"flex-between\">\r\n     <div class=\"price-desc\">可买入: <span>{{orderInfo.remainAmount}}</span> KTT</div>\r\n    <div class=\"price-desc\">余额: <span>{{usdtBalance}}}</span> KTT</div>\r\n  </div>\r\n  \r\n  <div class=\"button-box\">\r\n    <van-button color=\"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)\" type=\"primary\" :loading=\"btn.swaploading\" size=\"large\" loading-text=\"兑换中...\" block v-if=\"Number(usdtAllowance) > 0\" @click=\"sellKtt\">卖出</van-button>\r\n     <van-button color=\"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)\" type=\"primary\" :loading=\"btn.swaploading\" v-else size=\"large\" loading-text=\"正在授权...\" @click=\"approveUsdt\">授权KTT</van-button>\r\n  </div>\r\n  </van-dialog>\r\n\r\n  </div>\r\n     </van-list>\r\n</template>\r\n<script>\r\nimport HeadTop from '@/components/HeadTop'\r\nimport { reactive, toRefs, computed, watch } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport { MaxUint256 } from \"@ethersproject/constants\";\r\nimport BigNumber from 'bignumber.js';\r\nimport _ from 'lodash'\r\nimport marketAbi from \"@/utils/marketAbi\";\r\nimport tokenAbi from \"@/utils/abi\";\r\nimport config from \"@/utils/config\";\r\nimport { Toast } from 'vant';\r\nimport dateformat from \"dateformat\"\r\nexport default {\r\n  components: {\r\n    HeadTop\r\n  },\r\n  setup () {\r\n    const store = useStore()\r\n    const data = reactive({\r\n      address: computed(() => store.state.accounts[0]),\r\n      web3: computed(() => store.state.provider),\r\n      marketContract: null,\r\n      usdtContract: null,\r\n      KttContract: null,\r\n      usdtAllowance: '',\r\n      usdtBalance: '0.00',\r\n      usdtAmount: '0.00',\r\n      kttAmount: '0.00',\r\n      ktmAmount: '0.00',\r\n      kttBalance: '0.00',\r\n      kttAllowance: '',\r\n      config: config,\r\n      price: '',\r\n       btn: {\r\n        loading: false,\r\n        swaploading: false\r\n      },\r\n      swapKttAmount: '',\r\n      swapAmount: '',\r\n      list: [],\r\n      show: false,\r\n      orderInfo: null,\r\n      page: 1,\r\n      limit: 15,\r\n      loading: false,\r\n      error: false,\r\n      finished: false,\r\n      initContract: () => {\r\n        data.marketContract = new data.web3.eth.Contract(marketAbi, config.sellMarketAddress)\r\n        data.usdtContract = new data.web3.eth.Contract(tokenAbi, config.usdtAddress)\r\n        data.kttContract = new data.web3.eth.Contract(tokenAbi, config.kttAddress)\r\n        data.initData()\r\n      },\r\n      initData: () => {\r\n        data.getBalance()\r\n        data.getUsdtAllowance()\r\n        data.getKttAllowance()\r\n        data.list = []\r\n        data.page = 1\r\n        data.getList()\r\n      },\r\n        onLoad () {\r\n        data.page++\r\n        data.getList()\r\n      },\r\n      getBalance: async () => {\r\n        let kttDecimals = await data.kttContract.methods.decimals().call()\r\n        let usdtDecimals = await data.usdtContract.methods.decimals().call()\r\n        let kttBalance = await data.kttContract.methods.balanceOf(data.address).call()\r\n        let usdtBalance = await data.usdtContract.methods.balanceOf(data.address).call()\r\n        data.kttBalance =  new BigNumber(kttBalance).dividedBy(10 ** kttDecimals).toFixed(2)\r\n        data.usdtBalance =  new BigNumber(usdtBalance).dividedBy(10 ** usdtDecimals).toFixed(2)\r\n      },\r\n      getUsdtAllowance: async () => {\r\n        let allowance = await data.usdtContract.methods.allowance(data.address, config.sellMarketAddress).call()\r\n        data.usdtAllowance = allowance;\r\n      },\r\n       getKttAllowance: async () => {\r\n        let allowance = await data.kttContract.methods.allowance(data.address, config.sellMarketAddress).call()\r\n        data.kttAllowance = allowance;\r\n        console.log(allowance, '-----------allowance')\r\n      },\r\n      approveUsdt: async () => {\r\n        data.btn.loading = true\r\n        try {\r\n          await data.usdtContract.methods.approve(config.sellMarketAddress, MaxUint256).send({from: data.address})\r\n          Toast('授权成功')\r\n          data.getUsdtAllowance()\r\n          data.btn.loading = false\r\n        } catch (error) {\r\n          Toast('授权失败')\r\n          data.btn.loading = false\r\n        }\r\n        \r\n      },\r\n      approveKtt: async () => {\r\n        data.btn.swaploading = true\r\n        try {\r\n          await data.kttContract.methods.approve(config.sellMarketAddress, MaxUint256).send({from: data.address})\r\n          Toast('授权成功')\r\n          data.getKttAllowance()\r\n          data.btn.swaploading = false\r\n        } catch (error) {\r\n          Toast('授权失败')\r\n          data.btn.swaploading = false\r\n        }\r\n        \r\n      },\r\n      addBuyRecord: async () => {\r\n        if(!data.swapKttAmount) {\r\n          Toast('请先输入数量')\r\n          return\r\n        }\r\n        if(Number(data.swapKttAmount) < 100) {\r\n          Toast('数量最小100')\r\n          return\r\n        }\r\n        if(Number(data.swapKttAmount) % 100 > 0) {\r\n          Toast('必须是100的整数倍')\r\n          return\r\n        }\r\n        if(!data.price) {\r\n          Toast('请先输入价格')\r\n          return\r\n        }\r\n        if(Number(data.swapKttAmount) > Number(data.kttBalance)) {\r\n          Toast('KTT余额不足')\r\n          return\r\n        }\r\n        \r\n         data.btn.loading = true\r\n        try {\r\n          let decimals = await data.kttContract.methods.decimals().call()\r\n          let usdtDecimals = await data.usdtContract.methods.decimals().call()\r\n          let amount = new BigNumber(data.swapKttAmount).multipliedBy(10 ** decimals).toFixed()\r\n          let price = new BigNumber(data.price).multipliedBy(10 ** usdtDecimals).toFixed()\r\n          await data.marketContract.methods.addBuyRecord(amount, price).send({from: data.address})\r\n          Toast('挂单成功')\r\n          data.initData()\r\n          data.btn.loading = false\r\n        } catch (error) {\r\n          Toast('挂单失败')\r\n          data.btn.loading = false\r\n        }\r\n      },\r\n      getList: async () => {\r\n        console.log(data.page,data.limit)\r\n        let info = await data.marketContract.methods.getUserRecords(data.page,data.limit).call({from: data.address})\r\n        let list = info.recordArr\r\n        console.log(info)\r\n        let arr = []\r\n         list.forEach((item) => {\r\n          console.log(item.kttAmount, item.haveSellAmount, item.isCancle)\r\n          if(Number(item.id) > 0 && !item.isCancle) {\r\n            console.log(1111)\r\n            arr.push({\r\n              kttAmount:  new BigNumber(item.kttAmount).dividedBy(10**18).toFixed(2),\r\n              haveSellAmount:  new BigNumber(item.haveSellAmount).dividedBy(10**18).toFixed(2),\r\n              price: new BigNumber(item.price).dividedBy(10**18).toFixed(2),\r\n              id:item.id,\r\n              remainAmount: new BigNumber(item.kttAmount).minus(item.haveSellAmount).dividedBy(10**18).toFixed(2),\r\n              isCancle: item.isCancle,\r\n              buyer: item.buyer\r\n            })\r\n          }\r\n        })\r\n          if (data.page === 1) {\r\n            data.list = arr\r\n          } else {\r\n            data.list.push(...arr)\r\n          }\r\n          data.loading = false\r\n          data.finished = !(Math.ceil(info.total / data.limit) > data.page)\r\n          if(!data.finished) {\r\n            data.onLoad()\r\n          }\r\n      },\r\n      toSell: (item) => {\r\n        data.show = true\r\n        data.orderInfo = item\r\n      },\r\n      sellKtt: async () => {\r\n        if(!data.swapAmount) {\r\n          Toast('请先输入数量')\r\n          return\r\n        }\r\n        if(Number(data.swapAmount * data.orderInfo.price) > Number(data.usdtBalance)) {\r\n          Toast('USDT余额不足')\r\n          return\r\n        }\r\n         data.btn.swaploading = true\r\n          let decimals = await data.kttContract.methods.decimals().call()\r\n          let amount = new BigNumber(data.swapAmount).multipliedBy(10 ** decimals).toFixed()\r\n        try {\r\n          await data.marketContract.methods.sell(data.orderInfo.id,amount).send({from: data.address})\r\n          Toast('买入成功')\r\n           data.initData()\r\n           data.show = false\r\n          data.btn.swaploading = false\r\n        } catch (error) {\r\n          Toast('买入失败')\r\n           data.show = false\r\n          data.btn.swaploading = false\r\n        }\r\n      },\r\n       cancle: async (id) => {\r\n        try {\r\n          await data.marketContract.methods.cancle(id).send({from: data.address})\r\n          Toast('取消成功')\r\n           data.initData()\r\n        } catch (error) {\r\n          Toast('取消失败')\r\n        }\r\n      },\r\n      getOutAmount: _.throttle(async function(){\r\n        if (!data.swapKttAmount || Number(data.swapKttAmount)  == 0 || !data.price || Number(data.price)==0) {\r\n          return '0.00'\r\n        }\r\n        let usdtAmount = new BigNumber(data.swapKttAmount).multipliedBy(data.price).toFixed(2)\r\n        data.usdtAmount = usdtAmount\r\n      }, 1000)\r\n    })\r\n    if (data.address) {\r\n      data.initContract()\r\n    }\r\n    watch(() => data.address, (val) => {\r\n      if (val) {\r\n        data.initContract()\r\n      }\r\n    })\r\n    const refData = toRefs(data);\r\n    return {\r\n      ...refData\r\n    };\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.swap{\r\n  padding: 16px;\r\n}\r\n.sympol{\r\n    font-size: 14px;\r\n}\r\n.swap-item{\r\n  background: #3F2E6F;\r\n  border-radius: 5px;\r\n  padding: 20px 14px;\r\n  margin-bottom: 15px;\r\n  .title{\r\n    text-align: center;\r\n    color: #fff;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    margin-bottom: 20px;\r\n  }\r\n  .price-desc{\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #E4D7FF;\r\n    margin: 15px 8px;\r\n    span{\r\n      color: #FFD511;\r\n    }\r\n  }\r\n}\r\n.title-sub{\r\n  font-size: 16px;\r\n  font-weight: 700;\r\n  margin: 20px 0;\r\n  color: #fff;\r\n}\r\n  .list-box{\r\n    padding-top: 20px;\r\n    .item{\r\n      background: #3F2E6F;\r\n    box-shadow: 0px 4px 0px 0px #3F2E6F;\r\n    border-radius: 15px;\r\n    padding: 25px 20px;\r\n    margin-bottom: 20px;\r\n      .top{\r\n          padding-bottom: 20px;\r\n          border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);\r\n        .top-item{\r\n          .num{\r\n            color: #fff;\r\n            font-size: 18px;\r\n            font-weight: 700;\r\n            margin-bottom: 4px;\r\n          }\r\n          .yellow{\r\n            color: #FFD511;\r\n          }\r\n          .desc{\r\n            color: rgba(255, 255, 255, 0.7);\r\n            font-size: 14px;\r\n          }\r\n        }\r\n        .line{\r\n          width: 0.5px;\r\n          height: 40px;\r\n          background: rgba(255, 255, 255, 0.1);\r\n          margin-right: 18px;\r\n        }\r\n      }\r\n      .bottom{\r\n        padding: 18px 0 0;\r\n        .status{\r\n          color: #0CD3DD;\r\n          font-size: 16px;\r\n          font-weight: 700;\r\n          padding-bottom: 4px;\r\n        }\r\n        .red{\r\n          color: #F3489D;\r\n        }\r\n        .row{\r\n          margin-top: 10px;\r\n          .name{\r\n            width: 110px;\r\n            color: rgba(255, 255, 255, 0.7);\r\n            font-size: 14px;\r\n          }\r\n          .value{\r\n            color: #fff;\r\n            font-size: 14px;\r\n          }\r\n        }\r\n      }\r\n      .btn-box{\r\n        margin-top: 16px;\r\n      }\r\n    }\r\n  }\r\n  .close-box{\r\n    margin-bottom: 20px;\r\n    margin-top: -6px;\r\n  }\r\n</style>\r\n","import { render } from \"./index.vue?vue&type=template&id=32b42f14&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=32b42f14&lang=less&scoped=true\"\n\nimport exportComponent from \"F:\\\\activeSelf\\\\ketai_vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-32b42f14\"]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=32b42f14&lang=less&scoped=true\""],"sourceRoot":""}