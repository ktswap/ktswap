{"version":3,"sources":["webpack:///./src/views/market/index.vue?c794","webpack:///./src/views/market/index.vue","webpack:///./src/views/market/index.vue?44c8"],"names":["class","_createElementVNode","_createBlock","_component_van_list","loading","_ctx","$event","immediate-check","error","error-text","finished","finished-text","onLoad","_createVNode","_component_HeadTop","title","isShowTop","isSubHeader","_hoisted_3","_component_van_field","style","center","clearable","label","placeholder","extra","_hoisted_4","_hoisted_5","_toDisplayString","Number","_component_van_button","type","size","loading-text","block","onClick","_hoisted_16","_createElementBlock","_Fragment","_renderList","item","index","key","kttAmount","_hoisted_21","_hoisted_22","price","_hoisted_25","_hoisted_28","haveSellAmount","_hoisted_31","remainAmount","_hoisted_34","isCancle","buyer","id","_component_van_dialog","show","showConfirmButton","_hoisted_39","_component_van_icon","name","color","_hoisted_40","swaploading","components","HeadTop","setup","store","useStore","data","reactive","address","computed","state","accounts","web3","provider","marketContract","usdtContract","KttContract","usdtAllowance","usdtBalance","usdtAmount","ktmAmount","kttBalance","kttAllowance","btn","swapKttAmount","swapAmount","list","orderInfo","page","limit","initContract","eth","Contract","marketAbi","config","marketAddress","tokenAbi","usdtAddress","kttContract","kttAddress","initData","getBalance","getUsdtAllowance","getKttAllowance","getList","methods","decimals","call","kttDecimals","usdtDecimals","balanceOf","BigNumber","dividedBy","toFixed","allowance","approveUsdt","approve","MaxUint256","send","from","Toast","approveKtt","addBuyRecord","amount","multipliedBy","getUserRecords","info","recordArr","arr","forEach","push","minus","Math","ceil","total","toSell","sellKtt","sell","cancle","getOutAmount","_","throttle","watch","val","refData","toRefs","__exports__","render"],"mappings":"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","file":"static/js/chunk-4208f530.4b2e88f1.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=20fd197a&lang=less&scoped=true\"","<template>\r\n <van-list v-model:loading=\"loading\" :immediate-check=\"false\" v-model:error=\"error\" error-text=\"请求失败，点击重新加载\" :finished=\"finished\" finished-text=\"没有更多了\" @load=\"onLoad\">\r\n  <div class=\"swap\">\r\n    <HeadTop title=\"买单市场\" :isShowTop=\"true\" :isSubHeader=\"false\"></HeadTop>\r\n    <div class=\"swap-item\">\r\n        <div class=\"title\">挂买单</div>\r\n          <van-field\r\n          style=\"margin-bottom: 12px\"\r\n    v-model=\"swapKttAmount\"\r\n    center\r\n    clearable\r\n    label=\"\"\r\n    @update:model-value=\"getOutAmount\"\r\n    placeholder=\"请输入购买数量\"\r\n  >\r\n    <template #extra>\r\n      <span class=\"sympol\">KTT</span>\r\n    </template>\r\n  </van-field>\r\n    <van-field\r\n    v-model=\"price\"\r\n    center\r\n    clearable\r\n    label=\"\"\r\n    @update:model-value=\"getOutAmount\"\r\n    placeholder=\"请输入单价\"\r\n  >\r\n    <template #extra>\r\n      <span class=\"sympol\">USDT / KTT</span>\r\n    </template>\r\n  </van-field>\r\n  <div class=\"flex-between\">\r\n    <div class=\"price-desc\">需要： <span>{{usdtAmount}}</span> USDT</div>\r\n    <div class=\"price-desc\">余额： <span>{{usdtBalance}}</span> USDT</div>\r\n  </div>\r\n  \r\n  <div class=\"button-box\">\r\n     <van-button type=\"primary\" :loading=\"btn.loading\" size=\"large\" loading-text=\"兑换中...\" block v-if=\"Number(usdtAllowance > 0)\" @click=\"addBuyRecord\">挂单</van-button>\r\n     <van-button type=\"primary\" :loading=\"btn.loading\" v-else size=\"large\" loading-text=\"正在授权...\" @click=\"approveUsdt\">授权USDT</van-button>\r\n  </div>\r\n    </div>\r\n    <div class=\"title-sub\">所有挂单</div>\r\n  \r\n      <div class=\"list-box\">\r\n       <div class=\"item\" v-for=\"(item, index) in list\" :key=\"index\">\r\n          <div class=\"top flex-middle\">\r\n            <div class=\"top-item flex-item\">\r\n               <div class=\"num\">{{item.kttAmount}}</div>\r\n               <div class=\"desc\">买入KTT数量</div>\r\n            </div>\r\n            <div class=\"line\"></div>\r\n            <div class=\"top-item flex-item\">\r\n               <div class=\"num yellow\">{{item.price}}USDT</div>\r\n               <div class=\"desc\">价格/KTT</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"bottom\">\r\n             <div class=\"row flex-middle\">\r\n                <div class=\"name\">卖出数量</div>\r\n                <div class=\"value\">{{item.haveSellAmount}}KTT</div>\r\n             </div>\r\n              <div class=\"row flex-middle\">\r\n                <div class=\"name\">剩余数量</div>\r\n                <div class=\"value\">{{item.remainAmount}}KTT</div>\r\n             </div>\r\n          </div>\r\n           <div class=\"btn-box flex-between\">\r\n               <span></span>\r\n                <van-button v-if=\"!item.isCancle && item.buyer == address\" type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block @click=\"cancle(item.id)\">取消</van-button>\r\n                <van-button  v-if=\"!item.isCancle\" type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block  @click=\"toSell(item)\">卖出KTT</van-button>\r\n                 <van-button v-if=\"item.isCancle\" type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block >已取消</van-button>\r\n           </div>\r\n       </div>\r\n    </div>\r\n    <van-dialog v-model:show=\"show\" class=\"swap-item\" :showConfirmButton=\"false\" style=\"padding: 0\" :title=\"''\">\r\n          <div class=\"close-box flex-between\">\r\n            <span></span>\r\n            <van-icon @click=\"show=false\" name=\"cross\" color=\"#fff\" size=\"20px\"/>\r\n          </div>\r\n          <van-field\r\n    v-model=\"swapAmount\"\r\n    center\r\n    clearable\r\n    label=\"\"\r\n    placeholder=\"请输入卖出数量\"\r\n  >\r\n    <template #extra>\r\n      <span class=\"sympol\">KTT</span>\r\n    </template>\r\n  </van-field>\r\n  <div class=\"flex-between\">\r\n     <div class=\"price-desc\">可卖出: <span>{{orderInfo.remainAmount}}</span> KTT</div>\r\n    <div class=\"price-desc\">余额: <span>{{kttBalance}}</span> KTT</div>\r\n  </div>\r\n  \r\n  <div class=\"button-box\">\r\n    <van-button color=\"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)\" type=\"primary\" :loading=\"btn.swaploading\" size=\"large\" loading-text=\"兑换中...\" block v-if=\"Number(kttAllowance) > 0\" @click=\"sellKtt\">卖出</van-button>\r\n     <van-button color=\"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)\" type=\"primary\" :loading=\"btn.swaploading\" v-else size=\"large\" loading-text=\"正在授权...\" @click=\"approveKtt\">授权KTT</van-button>\r\n  </div>\r\n  </van-dialog>\r\n\r\n  </div>\r\n     </van-list>\r\n</template>\r\n<script>\r\nimport HeadTop from '@/components/HeadTop'\r\nimport { reactive, toRefs, computed, watch } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport { MaxUint256 } from \"@ethersproject/constants\";\r\nimport BigNumber from 'bignumber.js';\r\nimport _ from 'lodash'\r\nimport marketAbi from \"@/utils/marketAbi\";\r\nimport tokenAbi from \"@/utils/abi\";\r\nimport config from \"@/utils/config\";\r\nimport { Toast } from 'vant';\r\nimport dateformat from \"dateformat\"\r\nexport default {\r\n  components: {\r\n    HeadTop\r\n  },\r\n  setup () {\r\n    const store = useStore()\r\n    const data = reactive({\r\n      address: computed(() => store.state.accounts[0]),\r\n      web3: computed(() => store.state.provider),\r\n      marketContract: null,\r\n      usdtContract: null,\r\n      KttContract: null,\r\n      usdtAllowance: '',\r\n      usdtBalance: '0.00',\r\n      usdtAmount: '0.00',\r\n      kttAmount: '0.00',\r\n      ktmAmount: '0.00',\r\n      kttBalance: '0.00',\r\n      kttAllowance: '',\r\n      price: '',\r\n       btn: {\r\n        loading: false,\r\n        swaploading: false\r\n      },\r\n      swapKttAmount: '',\r\n      swapAmount: '',\r\n      list: [],\r\n      show: false,\r\n      orderInfo: null,\r\n      page: 1,\r\n      limit: 5,\r\n      loading: false,\r\n      error: false,\r\n      finished: false,\r\n      initContract: () => {\r\n        data.marketContract = new data.web3.eth.Contract(marketAbi, config.marketAddress)\r\n        data.usdtContract = new data.web3.eth.Contract(tokenAbi, config.usdtAddress)\r\n        data.kttContract = new data.web3.eth.Contract(tokenAbi, config.kttAddress)\r\n        data.initData()\r\n      },\r\n      initData: () => {\r\n        data.getBalance()\r\n        data.getUsdtAllowance()\r\n        data.getKttAllowance()\r\n        data.list = []\r\n        data.page = 1\r\n        data.getList()\r\n      },\r\n        onLoad () {\r\n        data.page++\r\n        data.getList()\r\n      },\r\n      getBalance: async () => {\r\n        let kttDecimals = await data.kttContract.methods.decimals().call()\r\n        let usdtDecimals = await data.usdtContract.methods.decimals().call()\r\n        let kttBalance = await data.kttContract.methods.balanceOf(data.address).call()\r\n        let usdtBalance = await data.usdtContract.methods.balanceOf(data.address).call()\r\n        data.kttBalance =  new BigNumber(kttBalance).dividedBy(10 ** kttDecimals).toFixed(2)\r\n        data.usdtBalance =  new BigNumber(usdtBalance).dividedBy(10 ** usdtDecimals).toFixed(2)\r\n      },\r\n      getUsdtAllowance: async () => {\r\n        let allowance = await data.usdtContract.methods.allowance(data.address, config.marketAddress).call()\r\n        data.usdtAllowance = allowance;\r\n      },\r\n       getKttAllowance: async () => {\r\n        let allowance = await data.kttContract.methods.allowance(data.address, config.marketAddress).call()\r\n        data.kttAllowance = allowance;\r\n        console.log(allowance, '-----------allowance')\r\n      },\r\n      approveUsdt: async () => {\r\n        data.btn.loading = true\r\n        try {\r\n          await data.usdtContract.methods.approve(config.marketAddress, MaxUint256).send({from: data.address})\r\n          Toast('授权成功')\r\n          data.getUsdtAllowance()\r\n          data.btn.loading = false\r\n        } catch (error) {\r\n          Toast('授权失败')\r\n          data.btn.loading = false\r\n        }\r\n        \r\n      },\r\n      approveKtt: async () => {\r\n        data.btn.swaploading = true\r\n        try {\r\n          await data.kttContract.methods.approve(config.marketAddress, MaxUint256).send({from: data.address})\r\n          Toast('授权成功')\r\n          data.getKttAllowance()\r\n          data.btn.swaploading = false\r\n        } catch (error) {\r\n          Toast('授权失败')\r\n          data.btn.swaploading = false\r\n        }\r\n        \r\n      },\r\n      addBuyRecord: async () => {\r\n        if(!data.swapKttAmount) {\r\n          Toast('请先输入数量')\r\n          return\r\n        }\r\n        if(!data.price) {\r\n          Toast('请先输入价格')\r\n          return\r\n        }\r\n        if(Number(data.usdtAmount) > Number(data.usdtBalance)) {\r\n          Toast('USDT余额不足')\r\n          return\r\n        }\r\n        \r\n         data.btn.loading = true\r\n        try {\r\n          let decimals = await data.kttContract.methods.decimals().call()\r\n          let usdtDecimals = await data.usdtContract.methods.decimals().call()\r\n          let amount = new BigNumber(data.swapKttAmount).multipliedBy(10 ** decimals).toFixed()\r\n          let price = new BigNumber(data.price).multipliedBy(10 ** usdtDecimals).toFixed()\r\n          await data.marketContract.methods.addBuyRecord(amount, price).send({from: data.address})\r\n          Toast('挂单成功')\r\n          data.initData()\r\n          data.btn.loading = false\r\n        } catch (error) {\r\n          Toast('挂单失败')\r\n          data.btn.loading = false\r\n        }\r\n      },\r\n      getList: async () => {\r\n        console.log(data.page,data.limit)\r\n        let info = await data.marketContract.methods.getUserRecords(data.page,data.limit).call({from: data.address})\r\n        let list = info.recordArr\r\n        console.log(info)\r\n        let arr = []\r\n         list.forEach((item) => {\r\n          if(Number(item.id) > 0 && !item.isCancle) {\r\n            arr.push({\r\n              kttAmount:  new BigNumber(item.kttAmount).dividedBy(10**18).toFixed(2),\r\n              haveSellAmount:  new BigNumber(item.haveSellAmount).dividedBy(10**18).toFixed(2),\r\n              price: new BigNumber(item.price).dividedBy(10**18).toFixed(2),\r\n              id:item.id,\r\n              remainAmount: new BigNumber(item.kttAmount).minus(item.haveSellAmount).dividedBy(10**18).toFixed(2),\r\n              isCancle: item.isCancle,\r\n              buyer: item.buyer\r\n            })\r\n          }\r\n        })\r\n          if (data.page === 1) {\r\n            data.list = arr\r\n          } else {\r\n            data.list.push(...arr)\r\n          }\r\n          data.loading = false\r\n          data.finished = !(Math.ceil(info.total / data.limit) > data.page)\r\n      },\r\n      toSell: (item) => {\r\n        data.show = true\r\n        data.orderInfo = item\r\n      },\r\n      sellKtt: async () => {\r\n        if(!data.swapAmount) {\r\n          Toast('请先输入数量')\r\n          return\r\n        }\r\n        if(Number(data.swapAmount) > Number(data.kttBalance)) {\r\n          Toast('KTT余额不足')\r\n          return\r\n        }\r\n         data.btn.swaploading = true\r\n          let decimals = await data.kttContract.methods.decimals().call()\r\n          let amount = new BigNumber(data.swapAmount).multipliedBy(10 ** decimals).toFixed()\r\n        try {\r\n          await data.marketContract.methods.sell(data.orderInfo.id,amount).send({from: data.address})\r\n          Toast('卖出成功')\r\n           data.initData()\r\n           data.show = false\r\n          data.btn.swaploading = false\r\n        } catch (error) {\r\n          Toast('卖出失败')\r\n           data.show = false\r\n          data.btn.swaploading = false\r\n        }\r\n      },\r\n       cancle: async (id) => {\r\n        try {\r\n          await data.marketContract.methods.cancle(id).send({from: data.address})\r\n          Toast('取消成功')\r\n           data.initData()\r\n        } catch (error) {\r\n          Toast('取消失败')\r\n        }\r\n      },\r\n      getOutAmount: _.throttle(async function(){\r\n        if (!data.swapKttAmount || Number(data.swapKttAmount)  == 0 || !data.price || Number(data.price)==0) {\r\n          return '0.00'\r\n        }\r\n        let usdtAmount = new BigNumber(data.swapKttAmount).multipliedBy(data.price).toFixed(2)\r\n        data.usdtAmount = usdtAmount\r\n      }, 1000)\r\n    })\r\n    if (data.address) {\r\n      data.initContract()\r\n    }\r\n    watch(() => data.address, (val) => {\r\n      if (val) {\r\n        data.initContract()\r\n      }\r\n    })\r\n    const refData = toRefs(data);\r\n    return {\r\n      ...refData\r\n    };\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.swap{\r\n  padding: 16px;\r\n}\r\n.sympol{\r\n    font-size: 14px;\r\n}\r\n.swap-item{\r\n  background: #3F2E6F;\r\n  border-radius: 5px;\r\n  padding: 20px 14px;\r\n  margin-bottom: 15px;\r\n  .title{\r\n    text-align: center;\r\n    color: #fff;\r\n    font-size: 16px;\r\n    font-weight: 600;\r\n    margin-bottom: 20px;\r\n  }\r\n  .price-desc{\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n    color: #E4D7FF;\r\n    margin: 15px 8px;\r\n    span{\r\n      color: #FFD511;\r\n    }\r\n  }\r\n}\r\n.title-sub{\r\n  font-size: 16px;\r\n  font-weight: 700;\r\n  margin: 20px 0;\r\n  color: #fff;\r\n}\r\n  .list-box{\r\n    padding-top: 20px;\r\n    .item{\r\n      background: #3F2E6F;\r\n    box-shadow: 0px 4px 0px 0px #3F2E6F;\r\n    border-radius: 15px;\r\n    padding: 25px 20px;\r\n    margin-bottom: 20px;\r\n      .top{\r\n          padding-bottom: 20px;\r\n          border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);\r\n        .top-item{\r\n          .num{\r\n            color: #fff;\r\n            font-size: 18px;\r\n            font-weight: 700;\r\n            margin-bottom: 4px;\r\n          }\r\n          .yellow{\r\n            color: #FFD511;\r\n          }\r\n          .desc{\r\n            color: rgba(255, 255, 255, 0.7);\r\n            font-size: 14px;\r\n          }\r\n        }\r\n        .line{\r\n          width: 0.5px;\r\n          height: 40px;\r\n          background: rgba(255, 255, 255, 0.1);\r\n          margin-right: 18px;\r\n        }\r\n      }\r\n      .bottom{\r\n        padding: 18px 0 0;\r\n        .status{\r\n          color: #0CD3DD;\r\n          font-size: 16px;\r\n          font-weight: 700;\r\n          padding-bottom: 4px;\r\n        }\r\n        .red{\r\n          color: #F3489D;\r\n        }\r\n        .row{\r\n          margin-top: 10px;\r\n          .name{\r\n            width: 110px;\r\n            color: rgba(255, 255, 255, 0.7);\r\n            font-size: 14px;\r\n          }\r\n          .value{\r\n            color: #fff;\r\n            font-size: 14px;\r\n          }\r\n        }\r\n      }\r\n      .btn-box{\r\n        margin-top: 16px;\r\n      }\r\n    }\r\n  }\r\n  .close-box{\r\n    margin-bottom: 20px;\r\n    margin-top: -6px;\r\n  }\r\n</style>\r\n","import { render } from \"./index.vue?vue&type=template&id=20fd197a&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=20fd197a&lang=less&scoped=true\"\n\nimport exportComponent from \"F:\\\\activeSelf\\\\ketai_vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-20fd197a\"]])\n\nexport default __exports__"],"sourceRoot":""}