{"version":3,"sources":["webpack:///./src/views/stake/list/index.vue","webpack:///./src/views/stake/list/index.vue?6acd","webpack:///./src/views/stake/list/index.vue?55f6"],"names":["class","_createElementVNode","_createElementBlock","_createVNode","_component_HeadTop","title","isShowTop","isSubHeader","_component_van_list","loading","_ctx","$event","immediate-check","error","error-text","finished","finished-text","onLoad","_Fragment","_renderList","item","index","key","_toDisplayString","stakeKttAmount","_hoisted_6","_hoisted_7","totalRewardKtm","_hoisted_10","_hoisted_13","lockTime","_hoisted_16","rate","_hoisted_19","haveBack","_hoisted_22","canGetAmount","_hoisted_25","stakeTime","_hoisted_28","endTime","Number","_hoisted_31","_component_van_button","type","style","block","onClick","id","components","HeadTop","setup","store","useStore","data","reactive","address","computed","state","accounts","web3","provider","swapContract","page","limit","list","initContract","eth","Contract","swapAbi","config","swapAddress","initData","getList","methods","getUserRecords","call","from","info","periodTime","getBlockTimestamp","timestamp","records","arr","forEach","push","BigNumber","dividedBy","toFixed","dayBackKtm","period","dateformat","Math","floor","multipliedBy","minus","ceil","total","withdrawRewardStakeRecord","withdrawStakeRecord","send","Toast","watch","val","refData","toRefs","__exports__","render"],"mappings":"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","file":"static/js/chunk-3a063dfd.726fd5d6.js","sourcesContent":["<template>\n  <div class=\"swap-box invest-box\">\n    <HeadTop title=\"质押记录\" :isShowTop=\"true\" :isSubHeader=\"false\"></HeadTop>\n    <van-list v-model:loading=\"loading\" :immediate-check=\"false\" v-model:error=\"error\" error-text=\"请求失败，点击重新加载\" :finished=\"finished\" finished-text=\"没有更多了\" @load=\"onLoad\">\n    <div class=\"list-box\">\n       <div class=\"item\" v-for=\"(item, index) in list\" :key=\"index\">\n          <div class=\"top flex-middle\">\n            <div class=\"top-item flex-item\">\n               <div class=\"num\">{{item.stakeKttAmount}}</div>\n               <div class=\"desc\">质押KTT</div>\n            </div>\n            <div class=\"line\"></div>\n            <div class=\"top-item flex-item\">\n               <div class=\"num yellow\">{{item.totalRewardKtm}}</div>\n               <div class=\"desc\">KTM总收益</div>\n            </div>\n          </div>\n          <div class=\"bottom\">\n             <div class=\"row flex-middle\">\n                <div class=\"name\">时长</div>\n                <div class=\"value\">{{item.lockTime}}天</div>\n             </div>\n              <div class=\"row flex-middle\">\n                <div class=\"name\">倍数</div>\n                <div class=\"value\">{{item.rate}}</div>\n             </div>\n             <div class=\"row flex-middle\">\n                <div class=\"name\">已领取</div>\n                <div class=\"value\">{{item.haveBack}}KTM</div>\n             </div>\n             <div class=\"row flex-middle\">\n                <div class=\"name\">待领取</div>\n                <div class=\"value\">{{item.canGetAmount}}KTM</div>\n             </div>\n             <div class=\"row flex-middle\">\n                <div class=\"name\">质押时间</div>\n                <div class=\"value\">{{item.stakeTime}}</div>\n             </div>\n             <div class=\"row flex-middle\">\n                <div class=\"name\">质押到期时间</div>\n                <div class=\"value\">{{item.endTime}}</div>\n             </div>\n          </div>\n           <div class=\"btn-box flex-between\" v-if=\"Number(item.canGetAmount) > 0\">\n               <span></span>\n                <van-button type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block @click=\"withdrawRewardStakeRecord(item.id)\">领取</van-button>\n           </div>\n       </div>\n    </div>\n    </van-list>\n  </div>  \n</template>\n<script>\nimport HeadTop from '@/components/HeadTop'\nimport { reactive, toRefs, computed, watch } from \"vue\";\nimport { useStore } from \"vuex\";\nimport swapAbi from \"@/utils/swapAbi\";\nimport { Toast } from 'vant';\nimport config from \"@/utils/config\";\nimport BigNumber from 'bignumber.js';\nimport dateformat from \"dateformat\"\nexport default {\n  components: {\n    HeadTop\n  },\n  setup () {\n    const store = useStore()\n    const data = reactive({\n      address: computed(() => store.state.accounts[0]),\n      web3: computed(() => store.state.provider),\n      swapContract: null,\n      page: 1,\n      limit: 5,\n      loading: false,\n      error: false,\n      finished: false,\n      list: [],\n      initContract: () => {\n        data.swapContract = new data.web3.eth.Contract(swapAbi, config.swapAddress)\n        data.initData()\n      },\n      initData: () => {\n         data.list = []\n        data.page = 1\n        data.getList()\n      },\n      onLoad () {\n        data.page++\n        data.getList()\n      },\n      getList: async () => {\n        let info = await data.swapContract.methods.getUserRecords(data.address,1,5).call({from: data.address})\n        let periodTime = await data.swapContract.methods.periodTime().call()\n        let timestamp = await data.swapContract.methods.getBlockTimestamp().call()\n        let list = info.records\n        console.log(list)\n        let arr = []\n         list.forEach((item) => {\n          if(Number(item.id) > 0) {\n            arr.push({\n              stakeKttAmount:  new BigNumber(item.stakeKttAmount).dividedBy(10**18).toFixed(2),\n              totalRewardKtm:  new BigNumber(item.totalRewardKtm).dividedBy(10**18).toFixed(2),\n              dayBackKtm: new BigNumber(item.dayBackKtm).dividedBy(10**18).toFixed(2),\n              id:item.id,\n              rate: item.rate / 10000,\n              lockTime: new BigNumber(item.period).dividedBy(periodTime).toFixed(1),\n              stakeTime: dateformat(item.stakeTime*1000, 'yyyy-mm-dd HH:MM:ss'),\n              endTime: dateformat((Number(item.stakeTime) + Number(item.lockTime))*1000, 'yyyy-mm-dd HH:MM:ss'),\n              haveBack: new BigNumber(item.haveBack).dividedBy(10**18).toFixed(2),\n              canGetAmount: timestamp >= Number(item.stakeTime) + Number(item.period) ? \n              new BigNumber(Math.floor(item.period / periodTime)).multipliedBy(item.dayBackKtm).minus(item.haveBack).dividedBy(10**18).toFixed(2) :\n              new BigNumber(Math.floor((timestamp - item.stakeTime) / periodTime)).multipliedBy(item.dayBackKtm).minus(item.haveBack).dividedBy(10**18).toFixed(2)\n            })\n          if (data.page === 1) {\n            data.list = arr\n          } else {\n            data.list.push(...arr)\n          }\n          data.loading = false\n          data.finished = !(Math.ceil(info.total / data.limit) > data.page) || info.total == 0\n          }\n        })\n      },\n      withdrawRewardStakeRecord: async (id) => {\n        try {\n          await data.swapContract.methods.withdrawStakeRecord(id).send({from: data.address})\n          Toast('领取成功')\n        } catch (error) {\n          Toast('领取失败')  \n        }\n        \n      } \n    })\n    if (data.address) {\n      data.initContract()\n    }\n    watch(() => data.address, (val) => {\n      if (val) {\n        data.initContract()\n      }\n    })\n    const refData = toRefs(data);\n    return {\n      ...refData\n    };\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.invest-box{\n  padding: 10px 16px 25px;\n  min-height: 100vh;\n  .list-box{\n    padding-top: 20px;\n    .item{\n      background: #3F2E6F;\n    box-shadow: 0px 4px 0px 0px #3F2E6F;\n    border-radius: 15px;\n    padding: 25px 20px;\n    margin-bottom: 20px;\n      .top{\n          padding-bottom: 20px;\n          border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);\n        .top-item{\n          .num{\n            color: #fff;\n            font-size: 18px;\n            font-weight: 700;\n            margin-bottom: 4px;\n          }\n          .yellow{\n            color: #FFD511;\n          }\n          .desc{\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 14px;\n          }\n        }\n        .line{\n          width: 0.5px;\n          height: 40px;\n          background: rgba(255, 255, 255, 0.1);\n          margin-right: 18px;\n        }\n      }\n      .bottom{\n        padding: 18px 0 0;\n        .status{\n          color: #0CD3DD;\n          font-size: 16px;\n          font-weight: 700;\n          padding-bottom: 4px;\n        }\n        .red{\n          color: #F3489D;\n        }\n        .row{\n          margin-top: 10px;\n          .name{\n            width: 110px;\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 14px;\n          }\n          .value{\n            color: #fff;\n            font-size: 14px;\n          }\n        }\n      }\n      .btn-box{\n        margin-top: 16px;\n      }\n    }\n  }\n}\n</style>\n","import { render } from \"./index.vue?vue&type=template&id=09b78c95&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=09b78c95&lang=less&scoped=true\"\n\nimport exportComponent from \"/Users/wangyouquan/priviteProject/ketai/ketai-vue/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-09b78c95\"]])\n\nexport default __exports__","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=09b78c95&lang=less&scoped=true\""],"sourceRoot":""}