(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-00a9554b"],{"3d0c":function(t,e,n){"use strict";n.r(e);n("a9e3");var a=n("7a23"),r=function(t){return Object(a["H"])("data-v-6914fe30"),t=t(),Object(a["F"])(),t},c={class:"swap"},o={class:"swap-item"},s=r((function(){return Object(a["k"])("div",{class:"title"},"质押KTT",-1)})),u=r((function(){return Object(a["k"])("span",{class:"sympol"},"KTT",-1)})),i={class:"flex-between"},l={class:"price-desc"},d=Object(a["m"])("获得: "),p=Object(a["m"])(" KTM"),b={class:"price-desc"},m=Object(a["m"])("余额: "),w=Object(a["m"])(" KTT"),f={class:"button-box"},k=Object(a["m"])("质押"),O=Object(a["m"])("授权KTT");function j(t,e,n,r,j,h){var g=Object(a["L"])("HeadTop"),v=Object(a["L"])("van-cell"),x=Object(a["L"])("van-field"),A=Object(a["L"])("van-button"),C=Object(a["L"])("van-picker"),y=Object(a["L"])("van-popup");return Object(a["E"])(),Object(a["j"])("div",c,[Object(a["n"])(g,{title:"质押",isShowTop:!0,isSubHeader:!1}),Object(a["k"])("div",o,[s,Object(a["n"])(v,{title:"选择质押周期",style:{"margin-bottom":"15px"},"is-link":"",value:t.pickerValue.text,onClick:e[0]||(e[0]=function(e){return t.showPicker=!0})},null,8,["value"]),Object(a["n"])(x,{modelValue:t.swapAmount,"onUpdate:modelValue":[e[1]||(e[1]=function(e){return t.swapAmount=e}),t.getOutKtmAmount],center:"",clearable:"",label:"",placeholder:"请输入质押数量"},{extra:Object(a["V"])((function(){return[u]})),_:1},8,["modelValue","onUpdate:modelValue"]),Object(a["k"])("div",i,[Object(a["k"])("div",l,[d,Object(a["k"])("span",null,Object(a["P"])(t.ktmAmount),1),p]),Object(a["k"])("div",b,[m,Object(a["k"])("span",null,Object(a["P"])(t.kttBalance),1),w])]),Object(a["k"])("div",f,[Number(t.kttAllowance)>0?(Object(a["E"])(),Object(a["h"])(A,{key:0,color:"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)",type:"primary",loading:t.btn.swaploading,size:"large","loading-text":"质押中...",block:"",onClick:t.swapKtm},{default:Object(a["V"])((function(){return[k]})),_:1},8,["loading","onClick"])):(Object(a["E"])(),Object(a["h"])(A,{key:1,color:"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)",type:"primary",loading:t.btn.swaploading,size:"large","loading-text":"正在授权...",onClick:t.approveKtt},{default:Object(a["V"])((function(){return[O]})),_:1},8,["loading","onClick"]))])]),Object(a["n"])(y,{show:t.showPicker,"onUpdate:show":e[3]||(e[3]=function(e){return t.showPicker=e}),round:"",position:"bottom"},{default:Object(a["V"])((function(){return[Object(a["n"])(C,{columns:t.columns,onCancel:e[2]||(e[2]=function(e){return t.showPicker=!1}),onConfirm:t.onConfirm},null,8,["columns","onConfirm"])]})),_:1},8,["show"])])}var h=n("5530"),g=n("1da1"),v=(n("96cf"),n("d3b7"),n("159b"),n("99af"),n("b680"),n("1a2e")),x=n("5502"),A=n("9d56"),C=n("c00b"),y=n("901e"),K=n.n(y),T=n("2ef0"),V=n.n(T),B=n("a1be"),R=n("722f"),F=n("01ea"),P=n("626a"),L=n("98b3"),_={components:{HeadTop:v["a"]},setup:function(){var t=Object(x["b"])(),e=Object(a["I"])({address:Object(a["f"])((function(){return t.state.accounts[0]})),web3:Object(a["f"])((function(){return t.state.provider})),intro:L["a"].get()||F["a"].rootAddress,swapContract:null,KttContract:null,KtmContract:null,kttAllowance:"",kttBalance:"0.00",kttAmount:"0.00",ktmAmount:"0.00",showPicker:!1,btn:{loading:!1,swaploading:!1},swapKttAmount:"",swapAmount:"",pickerValue:null,columns:[],initContract:function(){e.swapContract=new e.web3.eth.Contract(B,F["a"].swapAddress),e.kttContract=new e.web3.eth.Contract(R,F["a"].kttAddress),e.ktmContract=new e.web3.eth.Contract(R,F["a"].ktmAddress),e.initData()},initData:function(){e.getBalance(),e.getKttAllowance(),e.getAllStakeType()},getAllStakeType:function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.swapContract.methods.getAllStakeType().call();case 2:return n=t.sent,t.next=5,e.swapContract.methods.periodTime().call();case 5:a=t.sent,r=[],n.forEach((function(t){r.push({text:"".concat(Number(t.period/a),"天,").concat(t.rate/1e4,"倍"),value:t.id,rate:t.rate})})),e.columns=r,e.pickerValue=r[0];case 11:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),onConfirm:function(t){e.pickerValue=t,e.showPicker=!1,e.getOutKtmAmount()},getBalance:function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.kttContract.methods.decimals().call();case 2:return n=t.sent,t.next=5,e.kttContract.methods.balanceOf(e.address).call();case 5:a=t.sent,e.kttBalance=new K.a(a).dividedBy(Math.pow(10,n)).toFixed(2);case 7:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),getKttAllowance:function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.kttContract.methods.allowance(e.address,F["a"].swapAddress).call();case 2:n=t.sent,e.kttAllowance=n;case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),approveKtt:function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.btn.swaploading=!0,t.prev=1,t.next=4,e.kttContract.methods.approve(F["a"].swapAddress,A["b"]).send({from:e.address});case 4:Object(P["a"])("授权成功"),e.getKttAllowance(),e.btn.swaploading=!1,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),Object(P["a"])("授权失败"),e.btn.swaploading=!1;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));function n(){return t.apply(this,arguments)}return n}(),swapKtm:function(){var t=Object(g["a"])(regeneratorRuntime.mark((function t(){var n,a,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapAmount){t.next=3;break}return Object(P["a"])("请先输入数量"),t.abrupt("return");case 3:if(!(Number(e.swapAmount)>Number(e.kttBalance))){t.next=6;break}return Object(P["a"])("KTT余额不足"),t.abrupt("return");case 6:return t.next=8,e.swapContract.methods.getUserInfo(e.intro).call();case 8:return n=t.sent,t.next=11,e.swapContract.methods.getUserInfo(e.address).call();case 11:if(a=t.sent,n.intro!=C["a"]||e.intro==F["a"].rootAddress||a.intro!=C["a"]){t.next=15;break}return Object(P["a"])("推荐人无效"),t.abrupt("return");case 15:return e.btn.swaploading=!0,t.next=18,e.kttContract.methods.decimals().call();case 18:return r=t.sent,c=new K.a(e.swapAmount).multipliedBy(Math.pow(10,r)).toFixed(),t.prev=20,t.next=23,e.swapContract.methods.stake(e.pickerValue.value,c,e.intro).send({from:e.address});case 23:Object(P["a"])("质押成功"),e.initData(),e.btn.swaploading=!1,t.next=32;break;case 28:t.prev=28,t.t0=t["catch"](20),Object(P["a"])("质押失败"),e.btn.swaploading=!1;case 32:case"end":return t.stop()}}),t,null,[[20,28]])})));function n(){return t.apply(this,arguments)}return n}(),getOutKtmAmount:V.a.throttle(Object(g["a"])(regeneratorRuntime.mark((function t(){var n,a,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapAmount&&0!=Number(e.swapAmount)){t.next=3;break}return e.ktmAmount="0.00",t.abrupt("return","0.00");case 3:return t.next=5,e.kttContract.methods.decimals().call();case 5:return n=t.sent,t.next=8,e.ktmContract.methods.decimals().call();case 8:return a=t.sent,r=new K.a(e.swapAmount).multipliedBy(Math.pow(10,n)).toFixed(),t.next=12,e.swapContract.methods.getKtmAmount(r).call();case 12:c=t.sent,e.ktmAmount=new K.a(c).multipliedBy(e.pickerValue.rate).dividedBy(1e4).dividedBy(Math.pow(10,a)).toFixed(2);case 14:case"end":return t.stop()}}),t)}))),1e3)});e.address&&e.initContract(),Object(a["T"])((function(){return e.address}),(function(t){t&&e.initContract()}));var n=Object(a["Q"])(e);return Object(h["a"])({},n)}},M=(n("e2a1"),n("6b0d")),N=n.n(M);const S=N()(_,[["render",j],["__scopeId","data-v-6914fe30"]]);e["default"]=S},b88e:function(t,e,n){},e2a1:function(t,e,n){"use strict";n("b88e")}}]);
//# sourceMappingURL=chunk-00a9554b.1252e8e9.js.map