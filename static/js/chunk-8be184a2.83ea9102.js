(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8be184a2"],{4138:function(t,e,n){"use strict";n("6017")},6017:function(t,e,n){},"6c6a":function(t,e,n){"use strict";n.r(e);n("a9e3");var a=n("7a23"),r=function(t){return Object(a["H"])("data-v-344bd8b8"),t=t(),Object(a["F"])(),t},c={class:"swap"},s={class:"swap-item"},o=r((function(){return Object(a["k"])("div",{class:"title"},"USDT 兑换 KTT",-1)})),u=r((function(){return Object(a["k"])("span",{class:"sympol"},"KTT",-1)})),i={class:"flex-between"},l={class:"price-desc"},d=Object(a["m"])("需要： "),p=Object(a["m"])(" USDT"),b={class:"price-desc"},m=Object(a["m"])("余额： "),w=Object(a["m"])(" USDT"),f={class:"button-box"},h=Object(a["m"])("兑换"),O=Object(a["m"])("授权USDT");function v(t,e,n,r,v,j){var k=Object(a["L"])("HeadTop"),g=Object(a["L"])("van-field"),x=Object(a["L"])("van-button");return Object(a["E"])(),Object(a["j"])("div",c,[Object(a["n"])(k,{title:"兑换",isShowTop:!0,isSubHeader:!1}),Object(a["k"])("div",s,[o,Object(a["n"])(g,{modelValue:t.swapKttAmount,"onUpdate:modelValue":[e[0]||(e[0]=function(e){return t.swapKttAmount=e}),t.getOutAmount],center:"",clearable:"",label:"",placeholder:"请输入兑换数量"},{extra:Object(a["V"])((function(){return[u]})),_:1},8,["modelValue","onUpdate:modelValue"]),Object(a["k"])("div",i,[Object(a["k"])("div",l,[d,Object(a["k"])("span",null,Object(a["P"])(t.usdtAmount),1),p]),Object(a["k"])("div",b,[m,Object(a["k"])("span",null,Object(a["P"])(t.usdtBalance),1),w])]),Object(a["k"])("div",f,[Number(t.usdtAllowance>0)?(Object(a["E"])(),Object(a["h"])(x,{key:0,type:"primary",loading:t.btn.loading,size:"large","loading-text":"兑换中...",block:"",onClick:t.swapByUsdt},{default:Object(a["V"])((function(){return[h]})),_:1},8,["loading","onClick"])):(Object(a["E"])(),Object(a["h"])(x,{key:1,type:"primary",loading:t.btn.loading,size:"large","loading-text":"正在授权...",onClick:t.approveUsdt},{default:Object(a["V"])((function(){return[O]})),_:1},8,["loading","onClick"]))])])])}var j=n("5530"),k=n("1da1"),g=(n("96cf"),n("b680"),n("1a2e")),x=n("5502"),A=n("9d56"),C=n("901e"),y=n.n(C),B=n("2ef0"),K=n.n(B),R=n("a1be"),U=n("722f"),T=n("01ea"),F=n("626a"),D={components:{HeadTop:g["a"]},setup:function(){var t=Object(x["b"])(),e=Object(a["I"])({address:Object(a["f"])((function(){return t.state.accounts[0]})),web3:Object(a["f"])((function(){return t.state.provider})),swapContract:null,usdtContract:null,KttContract:null,KtmContract:null,usdtAllowance:"",kttAllowance:"",usdtBalance:"0.00",kttBalance:"0.00",usdtAmount:"0.00",kttAmount:"0.00",ktmAmount:"0.00",btn:{loading:!1,swaploading:!1},swapKttAmount:"",swapAmount:"",pickerValue:{text:"显示器",value:1},columns:[{text:"显示器",value:1},{text:"主机",value:2},{text:"主播",value:3},{text:"麦克风",value:4},{text:"声卡",value:5}],initContract:function(){e.swapContract=new e.web3.eth.Contract(R,T["a"].swapAddress),e.usdtContract=new e.web3.eth.Contract(U,T["a"].usdtAddress),e.kttContract=new e.web3.eth.Contract(U,T["a"].kttAddress),e.ktmContract=new e.web3.eth.Contract(U,T["a"].ktmAddress),e.initData()},initData:function(){e.getBalance(),e.getUsdtAllowance(),e.getKttAllowance()},getBalance:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){var n,a,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.kttContract.methods.decimals().call();case 2:return n=t.sent,t.next=5,e.usdtContract.methods.decimals().call();case 5:return a=t.sent,t.next=8,e.kttContract.methods.balanceOf(e.address).call();case 8:return r=t.sent,t.next=11,e.usdtContract.methods.balanceOf(e.address).call();case 11:c=t.sent,e.kttBalance=new y.a(r).dividedBy(Math.pow(10,n)).toFixed(2),e.usdtBalance=new y.a(c).dividedBy(Math.pow(10,a)).toFixed(2);case 14:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),getUsdtAllowance:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.usdtContract.methods.allowance(e.address,T["a"].swapAddress).call();case 2:n=t.sent,e.usdtAllowance=n;case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),getKttAllowance:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.kttContract.methods.allowance(e.address,T["a"].swapAddress).call();case 2:n=t.sent,e.kttAllowance=n;case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),approveUsdt:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.btn.loading=!0,t.prev=1,t.next=4,e.usdtContract.methods.approve(T["a"].swapAddress,A["b"]).send({from:e.address});case 4:Object(F["a"])("授权成功"),e.getUsdtAllowance(),e.btn.loading=!1,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),Object(F["a"])("授权失败"),e.btn.loading=!1;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));function n(){return t.apply(this,arguments)}return n}(),approveKtt:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.btn.swaploading=!0,t.prev=1,t.next=4,e.kttContract.methods.approve(T["a"].swapAddress,A["b"]).send({from:e.address});case 4:Object(F["a"])("授权成功"),e.getKttAllowance(),e.btn.swaploading=!1,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),Object(F["a"])("授权失败"),e.btn.swaploading=!1;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));function n(){return t.apply(this,arguments)}return n}(),swapByUsdt:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapKttAmount){t.next=3;break}return Object(F["a"])("请先输入数量"),t.abrupt("return");case 3:if(!(Number(e.usdtAmount)>Number(e.usdtBalance))){t.next=6;break}return Object(F["a"])("USDT余额不足"),t.abrupt("return");case 6:return e.btn.loading=!0,t.prev=7,t.next=10,e.kttContract.methods.decimals().call();case 10:return n=t.sent,a=new y.a(e.swapKttAmount).multipliedBy(Math.pow(10,n)).toFixed(),t.next=14,e.swapContract.methods.swapByUsdt(a).send({from:e.address});case 14:Object(F["a"])("兑换成功"),e.getBalance(),e.btn.loading=!1,t.next=23;break;case 19:t.prev=19,t.t0=t["catch"](7),Object(F["a"])("兑换失败"),e.btn.loading=!1;case 23:case"end":return t.stop()}}),t,null,[[7,19]])})));function n(){return t.apply(this,arguments)}return n}(),swapKtm:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapAmount){t.next=3;break}return Object(F["a"])("请先输入数量"),t.abrupt("return");case 3:if(!(Number(e.swapAmount)>Number(e.kttBalance))){t.next=6;break}return Object(F["a"])("KTT余额不足"),t.abrupt("return");case 6:return e.btn.swaploading=!0,t.next=9,e.kttContract.methods.decimals().call();case 9:return n=t.sent,a=new y.a(e.swapAmount).multipliedBy(Math.pow(10,n)).toFixed(),t.prev=11,t.next=14,e.swapContract.methods.swapKtm(a).send({from:e.address});case 14:Object(F["a"])("兑换成功"),e.initData(),e.btn.swaploading=!1,t.next=23;break;case 19:t.prev=19,t.t0=t["catch"](11),Object(F["a"])("兑换失败"),e.btn.swaploading=!1;case 23:case"end":return t.stop()}}),t,null,[[11,19]])})));function n(){return t.apply(this,arguments)}return n}(),getOutAmount:K.a.throttle(Object(k["a"])(regeneratorRuntime.mark((function t(){var n,a,r,c,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapKttAmount&&0!=Number(e.swapKttAmount)){t.next=2;break}return t.abrupt("return","0.00");case 2:return t.next=4,e.kttContract.methods.decimals().call();case 4:return n=t.sent,a=new y.a(e.swapKttAmount).multipliedBy(Math.pow(10,n)).toFixed(),t.next=8,e.swapContract.methods.getUsdtAmount(a).call();case 8:return r=t.sent,t.next=11,e.usdtContract.methods.decimals().call();case 11:c=t.sent,s=new y.a(r).dividedBy(Math.pow(10,c)).toFixed(2),e.usdtAmount=s;case 14:case"end":return t.stop()}}),t)}))),1e3),getOutKtmAmount:K.a.throttle(Object(k["a"])(regeneratorRuntime.mark((function t(){var n,a,r,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapAmount&&0!=Number(e.swapAmount)){t.next=3;break}return e.ktmAmount="0.00",t.abrupt("return","0.00");case 3:return t.next=5,e.kttContract.methods.decimals().call();case 5:return n=t.sent,t.next=8,e.ktmContract.methods.decimals().call();case 8:return a=t.sent,r=new y.a(e.swapAmount).multipliedBy(Math.pow(10,n)).toFixed(),t.next=12,e.swapContract.methods.getKtmAmount(r).call();case 12:c=t.sent,e.ktmAmount=new y.a(c).dividedBy(Math.pow(10,a)).toFixed(2);case 14:case"end":return t.stop()}}),t)}))),1e3)});e.address&&e.initContract(),Object(a["T"])((function(){return e.address}),(function(t){t&&e.initContract()}));var n=Object(a["Q"])(e);return Object(j["a"])({},n)}},M=(n("4138"),n("6b0d")),V=n.n(M);const N=V()(D,[["render",v],["__scopeId","data-v-344bd8b8"]]);e["default"]=N}}]);
//# sourceMappingURL=chunk-8be184a2.83ea9102.js.map