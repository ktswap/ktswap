(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3f4fc73f"],{"76a7":function(t,e,n){"use strict";n.r(e);n("a9e3");var a=n("7a23"),r=n("8d5e"),c=n.n(r),o=n("c2a5"),s=n.n(o),i=n("ab9f"),u=n.n(i),d=function(t){return Object(a["H"])("data-v-4c577d35"),t=t(),Object(a["F"])(),t},l={class:"swap-box"},b={class:"img-box"},p={key:0,src:c.a,alt:""},f={key:1,src:s.a,alt:""},g={class:"btn-box"},w=Object(a["m"])("合成"),j=Object(a["m"])("授权"),m=d((function(){return Object(a["k"])("img",{class:"show-img",src:u.a},null,-1)}));function O(t,e,n,r,c,o){var s=Object(a["K"])("HeadTop"),i=Object(a["K"])("van-button"),u=Object(a["K"])("van-dialog");return Object(a["E"])(),Object(a["j"])(a["a"],null,[Object(a["k"])("div",l,[Object(a["n"])(s,{title:"合成",isShowTop:!0,isSubHeader:!1}),Object(a["k"])("div",b,[!t.btn.loading||Number(t.kttAllowance)<=0?(Object(a["E"])(),Object(a["j"])("img",p)):Number(t.kttAllowance)>0&&t.btn.loading?(Object(a["E"])(),Object(a["j"])("img",f)):Object(a["i"])("",!0)]),Object(a["k"])("div",g,[Number(t.kttAllowance)>0?(Object(a["E"])(),Object(a["h"])(i,{key:0,color:"linear-gradient(270deg, #00DFB2 0%, #00C4DE 100%)",type:"primary",size:"large",loading:t.btn.loading,"loading-text":"正在合成...",block:"",onClick:t.mergeNft},{default:Object(a["U"])((function(){return[w]})),_:1},8,["loading","onClick"])):(Object(a["E"])(),Object(a["h"])(i,{key:1,color:"linear-gradient(270deg, #00DFB2 0%, #00C4DE 100%)",type:"primary",size:"large",loading:t.btn.loading,"loading-text":"正在授权...",block:"",onClick:t.approveKtt},{default:Object(a["U"])((function(){return[j]})),_:1},8,["loading","onClick"]))])]),Object(a["n"])(u,{show:t.show,"onUpdate:show":e[0]||(e[0]=function(e){return t.show=e}),title:""},{default:Object(a["U"])((function(){return[m]})),_:1},8,["show"])],64)}var h=n("5530"),k=n("1da1"),v=(n("b680"),n("96cf"),n("1a2e")),x=n("5502"),C=n("a1be"),A=n("722f"),y=n("626a"),K=n("01ea"),N=n("9d56"),E=n("c00b"),_=n("901e"),D=n.n(_),R=n("98b3"),U={components:{HeadTop:v["a"]},setup:function(){var t=Object(x["b"])(),e=Object(a["I"])({address:Object(a["f"])((function(){return t.state.accounts[0]})),web3:Object(a["f"])((function(){return t.state.provider})),swapContract:null,voiceNftContract:null,intro:R["a"].get()||K["a"].rootAddress,show:!1,kttAllowance:"",btn:{loading:!1},initContract:function(){e.swapContract=new e.web3.eth.Contract(C,K["a"].swapAddress),e.kttContract=new e.web3.eth.Contract(A,K["a"].kttAddress),e.initData()},initData:function(){e.getKttAllowance()},getKttAllowance:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.kttContract.methods.allowance(e.address,K["a"].swapAddress).call();case 2:n=t.sent,e.kttAllowance=n;case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),approveKtt:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.btn.swaploading=!0,t.prev=1,t.next=4,e.kttContract.methods.approve(K["a"].swapAddress,N["b"]).send({from:e.address});case 4:Object(y["a"])("授权成功"),e.getKttAllowance(),e.btn.swaploading=!1,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),Object(y["a"])("授权失败"),e.btn.swaploading=!1;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));function n(){return t.apply(this,arguments)}return n}(),mergeNft:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){var n,a,r,c,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.kttContract.methods.balanceOf(e.address).call();case 2:return n=t.sent,t.next=5,e.swapContract.methods.mergePrice().call();case 5:return a=t.sent,t.next=8,e.kttContract.methods.decimals().call();case 8:if(r=t.sent,c=new D.a(a).dividedBy(Math.pow(10,r)).toFixed(2),!(Number(n)<Number(a))){t.next=13;break}return Object(y["a"])("KTT余额不足".concat(c)),t.abrupt("return");case 13:return t.next=15,e.swapContract.methods.getUserInfo(e.intro).call();case 15:return o=t.sent,t.next=18,e.swapContract.methods.getUserInfo(e.address).call();case 18:if(s=t.sent,o.intro!=E["a"]||e.intro==K["a"].rootAddress||s.intro!=E["a"]){t.next=22;break}return Object(y["a"])("推荐人无效"),t.abrupt("return");case 22:return e.btn.loading=!0,t.prev=23,t.next=26,e.swapContract.methods.mergeNft(e.intro).send({from:e.address});case 26:Object(y["a"])("合成成功"),e.show=!0,e.btn.loading=!1,t.next=36;break;case 31:t.prev=31,t.t0=t["catch"](23),Object(y["a"])("合成失败"),e.btn.loading=!1;case 36:case"end":return t.stop()}}),t,null,[[23,31]])})));function n(){return t.apply(this,arguments)}return n}()});e.address&&e.initContract(),Object(a["S"])((function(){return e.address}),(function(t){t&&e.initContract()}));var n=Object(a["P"])(e);return Object(h["a"])({},n)}},T=(n("a692"),n("6b0d")),F=n.n(T);const H=F()(U,[["render",O],["__scopeId","data-v-4c577d35"]]);e["default"]=H},"8a06":function(t,e,n){},"8d5e":function(t,e,n){t.exports=n.p+"static/img/merge.47933a4b.png"},a692:function(t,e,n){"use strict";n("8a06")},ab9f:function(t,e,n){t.exports=n.p+"static/img/index_img.493d4559.png"},c2a5:function(t,e,n){t.exports=n.p+"static/img/_4.e8519102.gif"}}]);
//# sourceMappingURL=chunk-3f4fc73f.aa75974e.js.map