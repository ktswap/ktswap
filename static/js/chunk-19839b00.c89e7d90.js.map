{"version":3,"sources":["webpack:///./src/views/merge/index.vue?9dec","webpack:///./src/views/merge/index.vue","webpack:///./src/views/merge/index.vue?5d81","webpack:///./src/assets/images/merge.png","webpack:///./src/assets/images/index_img.png","webpack:///./src/assets/images/_4.gif","webpack:///./src/views/merge/index.vue?6fd6"],"names":["class","src","_imports_0","alt","_imports_1","_createElementVNode","_imports_2","_createVNode","_component_HeadTop","title","isShowTop","isSubHeader","_ctx","loading","Number","_createElementBlock","_component_van_field","$event","type","center","label","placeholder","extra","_hoisted_6","_createBlock","_component_van_button","color","size","loading-text","block","onClick","_component_van_dialog","show","_hoisted_10","components","HeadTop","setup","store","useStore","data","reactive","address","computed","state","accounts","web3","provider","swapContract","voiceNftContract","intro","get","config","rootAddress","amount","kttAllowance","btn","initContract","eth","Contract","swapAbi","swapAddress","kttContract","tokenAbi","kttAddress","initData","getKttAllowance","methods","allowance","call","approveKtt","swaploading","approve","MaxUint256","send","from","Toast","mergeNft","balanceOf","balance","minInvestAmount","decimals","kttDecimals","BigNumber","multipliedBy","toFixed","getUserInfo","introUserInfo","userUserInfo","AddressZero","invest","watch","val","refData","toRefs","__exports__","render","module","exports"],"mappings":"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","file":"static/js/chunk-19839b00.c89e7d90.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=deba3f88&lang=less&scoped=true\"","<template>\n  <div class=\"swap-box invest-box\">\n    <HeadTop title=\"合成\" :isShowTop=\"true\" :isSubHeader=\"false\"></HeadTop>\n    <div class=\"img-box\">\n      <img v-if=\"!btn.loading || Number(kttAllowance) <=0\" src=\"@/assets/images/merge.png\" alt=\"\">\n       <img v-else-if=\"Number(kttAllowance) > 0 && btn.loading\" src=\"@/assets/images/_4.gif\" alt=\"\">\n    </div>\n    <div class=\"input-box\">\n             <van-field class=\"cell-input\"\n    v-model=\"amount\"\n    type=\"number\"\n    center\n    label=\"\"\n    placeholder=\"请输入投资数量\"\n  >\n    <template #extra>\n      <span class=\"sympol\">KTT</span>\n    </template>\n  </van-field>\n  </div>\n    <div class=\"btn-box\">\n      <van-button v-if=\"Number(kttAllowance) > 0\" color=\"linear-gradient(270deg, #00DFB2 0%, #00C4DE 100%)\" type=\"primary\"  size=\"large\" :loading=\"btn.loading\" loading-text=\"正在合成...\" block @click=\"mergeNft\">合成</van-button>\n      <van-button v-else color=\"linear-gradient(270deg, #00DFB2 0%, #00C4DE 100%)\" type=\"primary\" size=\"large\" :loading=\"btn.loading\" loading-text=\"正在授权...\" block @click=\"approveKtt\">授权</van-button>\n    </div>\n  </div>\n  <van-dialog v-model:show=\"show\" title=\"\">\n  <img class=\"show-img\" src=\"@/assets/images/index_img.png\" />\n</van-dialog>\n</template>\n<script>\nimport HeadTop from '@/components/HeadTop'\nimport { reactive, toRefs, computed, watch } from \"vue\";\nimport { useStore } from \"vuex\";\nimport swapAbi from \"@/utils/swapAbi\";\nimport tokenAbi from \"@/utils/abi.json\";\nimport { Toast } from 'vant';\nimport config from \"@/utils/config\";\nimport { MaxUint256, AddressZero } from \"@ethersproject/constants\";\nimport BigNumber from 'bignumber.js';\nimport { intro } from '@/storage'\nexport default {\n  components: {\n    HeadTop\n  },\n  setup () {\n    const store = useStore()\n    const data = reactive({\n      address: computed(() => store.state.accounts[0]),\n      web3: computed(() => store.state.provider),\n      swapContract: null,\n      voiceNftContract: null,\n      intro: intro.get() || config.rootAddress,\n      show: false,\n      amount: '',\n      kttAllowance: '',\n       btn: {\n        loading: false\n      },\n      initContract: () => {\n        data.swapContract = new data.web3.eth.Contract(swapAbi, config.swapAddress)\n        data.kttContract = new data.web3.eth.Contract(tokenAbi, config.kttAddress)\n        data.initData()\n      },\n      initData: () => {\n        data.getKttAllowance()\n      },\n       getKttAllowance: async () => {\n        let allowance = await data.kttContract.methods.allowance(data.address, config.swapAddress).call()\n        data.kttAllowance = allowance;\n      },\n      approveKtt: async () => {\n        data.btn.swaploading = true\n        try {\n          await data.kttContract.methods.approve(config.swapAddress, MaxUint256).send({from: data.address})\n          Toast('授权成功')\n          data.getKttAllowance()\n          data.btn.swaploading = false\n        } catch (error) {\n          Toast('授权失败')\n          data.btn.swaploading = false\n        }\n        \n      },\n      mergeNft: async () => {\n        let balance = await data.kttContract.methods.balanceOf(data.address).call()\n        let minInvestAmount = await data.swapContract.methods.minInvestAmount().call()\n        console.log(minInvestAmount)\n        let kttDecimals = await data.kttContract.methods.decimals().call()\n        let amount = new BigNumber(data.amount).multipliedBy(10 ** kttDecimals).toFixed()\n        if(!data.amount) {\n           Toast(`请输入投资数量`)\n          return\n        }\n         if(Number(amount) < Number(minInvestAmount)) {\n          Toast(`KTT投资数量最小500KTT`)\n          return\n        }\n        if(Number(balance) < Number(amount)) {\n          Toast(`KTT余额不足`)\n          return\n        }\n          let introUserInfo = await data.swapContract.methods.getUserInfo(data.intro).call()\n           let userUserInfo = await data.swapContract.methods.getUserInfo(data.address).call()\n        if(introUserInfo.intro == AddressZero && data.intro != config.rootAddress && userUserInfo.intro == AddressZero) {\n          Toast('推荐人无效')\n          return\n        }\n        data.btn.loading = true\n        try {\n          await data.swapContract.methods.invest(amount, data.intro).send({from: data.address})\n          Toast('合成成功')\n          data.show = true\n          data.btn.loading = false\n        } catch (error) {\n          console.log(error)\n          Toast('合成失败')\n          data.btn.loading = false\n        }\n      }\n    })\n    if (data.address) {\n      data.initContract()\n    }\n    watch(() => data.address, (val) => {\n      if (val) {\n        data.initContract()\n      }\n    })\n    const refData = toRefs(data);\n    return {\n      ...refData\n    };\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.swap-box{\n  min-height: calc(100vh - 44px);\n  background: url('~@/assets/images/merge_bg.png') no-repeat;\n  background-size: cover;\n}\n.show-img{\n  display: block;\n  width: 100%;\n}\n.img-box{\n  // padding-top: 30px;\n  min-height: 480px;\n  img{\n    display: block;\n    width: 100%;\n  }\n}\n.input-box{\n  margin: 0 20px;\n}\n.btn-box{\n  padding: 20px 50px 0;\n}\n</style>\n\n<style lang=\"less\">\n#app {\n  .invest-box{\n    .van-cell{\n      background: rgba(0, 0, 0, 0.32);\n    }\n  }\n}\n</style>\n","import { render } from \"./index.vue?vue&type=template&id=deba3f88&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=deba3f88&lang=less&scoped=true\"\nimport \"./index.vue?vue&type=style&index=1&id=deba3f88&lang=less\"\n\nimport exportComponent from \"/Users/wangyouquan/priviteProject/ketai/ketai-vue/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-deba3f88\"]])\n\nexport default __exports__","module.exports = __webpack_public_path__ + \"static/img/merge.47933a4b.png\";","module.exports = __webpack_public_path__ + \"static/img/index_img.8839ad11.png\";","module.exports = __webpack_public_path__ + \"static/img/_4.e8519102.gif\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=1&id=deba3f88&lang=less\""],"sourceRoot":""}