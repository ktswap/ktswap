{"version":3,"sources":["webpack:///./src/views/merge/index.vue","webpack:///./src/views/merge/index.vue?5d81","webpack:///./src/assets/images/merge.png","webpack:///./src/views/merge/index.vue?c709","webpack:///./src/assets/images/index_img.png","webpack:///./node_modules/@ethersproject/constants/lib.esm/addresses.js","webpack:///./src/assets/images/_4.gif"],"names":["class","src","_imports_0","alt","_imports_1","_createElementVNode","_imports_2","_createVNode","_component_HeadTop","title","isShowTop","isSubHeader","_ctx","loading","Number","_createElementBlock","_createBlock","_component_van_button","color","type","size","loading-text","block","onClick","_component_van_dialog","show","$event","_hoisted_8","components","HeadTop","setup","store","useStore","data","reactive","address","computed","state","accounts","web3","provider","swapContract","voiceNftContract","intro","get","config","rootAddress","kttAllowance","btn","initContract","eth","Contract","swapAbi","swapAddress","kttContract","tokenAbi","kttAddress","initData","getKttAllowance","methods","allowance","call","approveKtt","swaploading","approve","MaxUint256","send","from","Toast","mergeNft","balanceOf","balance","mergePrice","needAmount","decimals","kttDecimals","amount","BigNumber","dividedBy","toFixed","getUserInfo","introUserInfo","userUserInfo","AddressZero","watch","val","refData","toRefs","__exports__","render","module","exports"],"mappings":"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","file":"static/js/chunk-453a870f.b9483dde.js","sourcesContent":["<template>\r\n  <div class=\"swap-box\">\r\n    <HeadTop title=\"合成\" :isShowTop=\"true\" :isSubHeader=\"false\"></HeadTop>\r\n    <div class=\"img-box\">\r\n      <img v-if=\"!btn.loading || Number(kttAllowance) <=0\" src=\"@/assets/images/merge.png\" alt=\"\">\r\n       <img v-else-if=\"Number(kttAllowance) > 0 && btn.loading\" src=\"@/assets/images/_4.gif\" alt=\"\">\r\n    </div>\r\n    <div class=\"btn-box\">\r\n      <van-button v-if=\"Number(kttAllowance) > 0\" color=\"linear-gradient(270deg, #00DFB2 0%, #00C4DE 100%)\" type=\"primary\"  size=\"large\" :loading=\"btn.loading\" loading-text=\"正在合成...\" block @click=\"mergeNft\">合成</van-button>\r\n      <van-button v-else color=\"linear-gradient(270deg, #00DFB2 0%, #00C4DE 100%)\" type=\"primary\" size=\"large\" :loading=\"btn.loading\" loading-text=\"正在授权...\" block @click=\"approveKtt\">授权</van-button>\r\n    </div>\r\n  </div>\r\n  <van-dialog v-model:show=\"show\" title=\"\">\r\n  <img class=\"show-img\" src=\"@/assets/images/index_img.png\" />\r\n</van-dialog>\r\n</template>\r\n<script>\r\nimport HeadTop from '@/components/HeadTop'\r\nimport { reactive, toRefs, computed, watch } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport swapAbi from \"@/utils/swapAbi\";\r\nimport tokenAbi from \"@/utils/abi.json\";\r\nimport { Toast } from 'vant';\r\nimport config from \"@/utils/config\";\r\nimport { MaxUint256, AddressZero } from \"@ethersproject/constants\";\r\nimport BigNumber from 'bignumber.js';\r\nimport { intro } from '@/storage'\r\nexport default {\r\n  components: {\r\n    HeadTop\r\n  },\r\n  setup () {\r\n    const store = useStore()\r\n    const data = reactive({\r\n      address: computed(() => store.state.accounts[0]),\r\n      web3: computed(() => store.state.provider),\r\n      swapContract: null,\r\n      voiceNftContract: null,\r\n      intro: intro.get() || config.rootAddress,\r\n      show: false,\r\n      kttAllowance: '',\r\n       btn: {\r\n        loading: false\r\n      },\r\n      initContract: () => {\r\n        data.swapContract = new data.web3.eth.Contract(swapAbi, config.swapAddress)\r\n        data.kttContract = new data.web3.eth.Contract(tokenAbi, config.kttAddress)\r\n        data.initData()\r\n      },\r\n      initData: () => {\r\n        data.getKttAllowance()\r\n      },\r\n       getKttAllowance: async () => {\r\n        let allowance = await data.kttContract.methods.allowance(data.address, config.swapAddress).call()\r\n        data.kttAllowance = allowance;\r\n      },\r\n      approveKtt: async () => {\r\n        data.btn.swaploading = true\r\n        try {\r\n          await data.kttContract.methods.approve(config.swapAddress, MaxUint256).send({from: data.address})\r\n          Toast('授权成功')\r\n          data.getKttAllowance()\r\n          data.btn.swaploading = false\r\n        } catch (error) {\r\n          Toast('授权失败')\r\n          data.btn.swaploading = false\r\n        }\r\n        \r\n      },\r\n      mergeNft: async () => {\r\n        let balance = await data.kttContract.methods.balanceOf(data.address).call()\r\n        let needAmount = await data.swapContract.methods.mergePrice().call()\r\n        let kttDecimals = await data.kttContract.methods.decimals().call()\r\n        let amount = new BigNumber(needAmount).dividedBy(10 ** kttDecimals).toFixed(2)\r\n        if(Number(balance) < Number(needAmount)) {\r\n          Toast(`KTT余额不足${amount}`)\r\n          return\r\n        }\r\n          let introUserInfo = await data.swapContract.methods.getUserInfo(data.intro).call()\r\n           let userUserInfo = await data.swapContract.methods.getUserInfo(data.address).call()\r\n        if(introUserInfo.intro == AddressZero && data.intro != config.rootAddress && userUserInfo.intro == AddressZero) {\r\n          Toast('推荐人无效')\r\n          return\r\n        }\r\n        data.btn.loading = true\r\n        try {\r\n          await data.swapContract.methods.mergeNft(data.intro).send({from: data.address})\r\n          Toast('合成成功')\r\n          data.show = true\r\n          data.btn.loading = false\r\n        } catch (error) {\r\n          console.log(error)\r\n          Toast('合成失败')\r\n          data.btn.loading = false\r\n        }\r\n      }\r\n    })\r\n    if (data.address) {\r\n      data.initContract()\r\n    }\r\n    watch(() => data.address, (val) => {\r\n      if (val) {\r\n        data.initContract()\r\n      }\r\n    })\r\n    const refData = toRefs(data);\r\n    return {\r\n      ...refData\r\n    };\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.swap-box{\r\n  min-height: calc(100vh - 44px);\r\n  background: url('~@/assets/images/merge_bg.png') no-repeat;\r\n  background-size: cover;\r\n}\r\n.show-img{\r\n  display: block;\r\n  width: 100%;\r\n}\r\n.img-box{\r\n  // padding-top: 30px;\r\n  min-height: 480px;\r\n  img{\r\n    display: block;\r\n    width: 100%;\r\n  }\r\n}\r\n.btn-box{\r\n  padding: 60px 50px 0;\r\n}\r\n</style>\r\n","import { render } from \"./index.vue?vue&type=template&id=4c577d35&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=4c577d35&lang=less&scoped=true\"\n\nimport exportComponent from \"F:\\\\activeSelf\\\\ketai_vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-4c577d35\"]])\n\nexport default __exports__","module.exports = __webpack_public_path__ + \"static/img/merge.47933a4b.png\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=4c577d35&lang=less&scoped=true\"","module.exports = __webpack_public_path__ + \"static/img/index_img.2b376a2f.png\";","export const AddressZero = \"0x0000000000000000000000000000000000000000\";\n//# sourceMappingURL=addresses.js.map","module.exports = __webpack_public_path__ + \"static/img/_4.e8519102.gif\";"],"sourceRoot":""}