(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-62a88c09"],{"04d1":function(t,e,n){var r=n("342f"),a=r.match(/firefox\/(\d+)/i);t.exports=!!a&&+a[1]},"3d0c":function(t,e,n){"use strict";n.r(e);n("a9e3");var r=n("7a23"),a=function(t){return Object(r["H"])("data-v-21b953f2"),t=t(),Object(r["F"])(),t},c={class:"swap"},o={class:"swap-item"},i=a((function(){return Object(r["k"])("div",{class:"title"},"质押KTT",-1)})),s=a((function(){return Object(r["k"])("span",{class:"sympol"},"KTT",-1)})),u={class:"flex-between"},l={class:"price-desc"},d=Object(r["m"])("获得: "),p=Object(r["m"])(" KTM"),b={class:"price-desc"},f=Object(r["m"])("余额: "),m=Object(r["m"])(" KTT"),w={class:"button-box"},h=Object(r["m"])("质押"),k=Object(r["m"])("授权KTT");function v(t,e,n,a,v,O){var j=Object(r["L"])("HeadTop"),g=Object(r["L"])("van-cell"),x=Object(r["L"])("van-field"),A=Object(r["L"])("van-button"),C=Object(r["L"])("van-picker"),y=Object(r["L"])("van-popup");return Object(r["E"])(),Object(r["j"])("div",c,[Object(r["n"])(j,{title:"质押",isShowTop:!0,isSubHeader:!1}),Object(r["k"])("div",o,[i,Object(r["n"])(g,{title:"选择质押周期",style:{"margin-bottom":"15px"},"is-link":"",value:t.pickerValue.text,onClick:e[0]||(e[0]=function(e){return t.showPicker=!0})},null,8,["value"]),Object(r["n"])(x,{modelValue:t.swapAmount,"onUpdate:modelValue":[e[1]||(e[1]=function(e){return t.swapAmount=e}),t.getOutKtmAmount],center:"",clearable:"",label:"",placeholder:"请输入质押数量"},{extra:Object(r["V"])((function(){return[s]})),_:1},8,["modelValue","onUpdate:modelValue"]),Object(r["k"])("div",u,[Object(r["k"])("div",l,[d,Object(r["k"])("span",null,Object(r["P"])(t.ktmAmount),1),p]),Object(r["k"])("div",b,[f,Object(r["k"])("span",null,Object(r["P"])(t.kttBalance),1),m])]),Object(r["k"])("div",w,[Number(t.kttAllowance)>0?(Object(r["E"])(),Object(r["h"])(A,{key:0,color:"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)",type:"primary",loading:t.btn.swaploading,size:"large","loading-text":"质押中...",block:"",onClick:t.swapKtm},{default:Object(r["V"])((function(){return[h]})),_:1},8,["loading","onClick"])):(Object(r["E"])(),Object(r["h"])(A,{key:1,color:"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)",type:"primary",loading:t.btn.swaploading,size:"large","loading-text":"正在授权...",onClick:t.approveKtt},{default:Object(r["V"])((function(){return[k]})),_:1},8,["loading","onClick"]))])]),Object(r["n"])(y,{show:t.showPicker,"onUpdate:show":e[3]||(e[3]=function(e){return t.showPicker=e}),round:"",position:"bottom"},{default:Object(r["V"])((function(){return[Object(r["n"])(C,{columns:t.columns,onCancel:e[2]||(e[2]=function(e){return t.showPicker=!1}),onConfirm:t.onConfirm},null,8,["columns","onConfirm"])]})),_:1},8,["show"])])}var O=n("5530"),j=n("1da1"),g=(n("96cf"),n("d3b7"),n("159b"),n("99af"),n("4e82"),n("b680"),n("1a2e")),x=n("5502"),A=n("9d56"),C=n("c00b"),y=n("901e"),K=n.n(y),T=n("2ef0"),V=n.n(T),B=n("a1be"),R=n("722f"),F=n("01ea"),P=n("626a"),M=n("98b3"),N={components:{HeadTop:g["a"]},setup:function(){var t=Object(x["b"])(),e=Object(r["I"])({address:Object(r["f"])((function(){return t.state.accounts[0]})),web3:Object(r["f"])((function(){return t.state.provider})),intro:M["a"].get()||F["a"].rootAddress,swapContract:null,KttContract:null,KtmContract:null,kttAllowance:"",kttBalance:"0.00",kttAmount:"0.00",ktmAmount:"0.00",showPicker:!1,btn:{loading:!1,swaploading:!1},swapKttAmount:"",swapAmount:"",pickerValue:null,columns:[],initContract:function(){e.swapContract=new e.web3.eth.Contract(B,F["a"].swapAddress),e.kttContract=new e.web3.eth.Contract(R,F["a"].kttAddress),e.ktmContract=new e.web3.eth.Contract(R,F["a"].ktmAddress),e.initData()},initData:function(){e.getBalance(),e.getKttAllowance(),e.getAllStakeType()},getAllStakeType:function(){var t=Object(j["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.swapContract.methods.getAllStakeType().call();case 2:return n=t.sent,t.next=5,e.swapContract.methods.periodTime().call();case 5:r=t.sent,a=[],n.forEach((function(t){a.push({text:"".concat(Number(t.period/r),"天,").concat(t.rate/1e4,"倍"),value:t.id,rate:t.rate})})),a=a.sort((function(t,e){return Number(t.rate)-Number(e.rate)})),e.columns=a,e.pickerValue=a[0];case 12:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),onConfirm:function(t){e.pickerValue=t,e.showPicker=!1,e.getOutKtmAmount()},getBalance:function(){var t=Object(j["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.kttContract.methods.decimals().call();case 2:return n=t.sent,t.next=5,e.kttContract.methods.balanceOf(e.address).call();case 5:r=t.sent,e.kttBalance=new K.a(r).dividedBy(Math.pow(10,n)).toFixed(2);case 7:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),getKttAllowance:function(){var t=Object(j["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.kttContract.methods.allowance(e.address,F["a"].swapAddress).call();case 2:n=t.sent,e.kttAllowance=n;case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),approveKtt:function(){var t=Object(j["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.btn.swaploading=!0,t.prev=1,t.next=4,e.kttContract.methods.approve(F["a"].swapAddress,A["b"]).send({from:e.address});case 4:Object(P["a"])("授权成功"),e.getKttAllowance(),e.btn.swaploading=!1,t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](1),Object(P["a"])("授权失败"),e.btn.swaploading=!1;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));function n(){return t.apply(this,arguments)}return n}(),swapKtm:function(){var t=Object(j["a"])(regeneratorRuntime.mark((function t(){var n,r,a,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapAmount){t.next=3;break}return Object(P["a"])("请先输入数量"),t.abrupt("return");case 3:if(!(Number(e.swapAmount)>Number(e.kttBalance))){t.next=6;break}return Object(P["a"])("KTT余额不足"),t.abrupt("return");case 6:return t.next=8,e.swapContract.methods.getUserInfo(e.intro).call();case 8:return n=t.sent,t.next=11,e.swapContract.methods.getUserInfo(e.address).call();case 11:if(r=t.sent,n.intro!=C["a"]||e.intro==F["a"].rootAddress||r.intro!=C["a"]){t.next=15;break}return Object(P["a"])("推荐人无效"),t.abrupt("return");case 15:return e.btn.swaploading=!0,t.next=18,e.kttContract.methods.decimals().call();case 18:return a=t.sent,c=new K.a(e.swapAmount).multipliedBy(Math.pow(10,a)).toFixed(),t.prev=20,t.next=23,e.swapContract.methods.stake(e.pickerValue.value,c,e.intro).send({from:e.address});case 23:Object(P["a"])("质押成功"),e.initData(),e.btn.swaploading=!1,t.next=32;break;case 28:t.prev=28,t.t0=t["catch"](20),Object(P["a"])("质押失败"),e.btn.swaploading=!1;case 32:case"end":return t.stop()}}),t,null,[[20,28]])})));function n(){return t.apply(this,arguments)}return n}(),getOutKtmAmount:V.a.throttle(Object(j["a"])(regeneratorRuntime.mark((function t(){var n,r,a,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.swapAmount&&0!=Number(e.swapAmount)){t.next=3;break}return e.ktmAmount="0.00",t.abrupt("return","0.00");case 3:return t.next=5,e.kttContract.methods.decimals().call();case 5:return n=t.sent,t.next=8,e.ktmContract.methods.decimals().call();case 8:return r=t.sent,a=new K.a(e.swapAmount).multipliedBy(Math.pow(10,n)).toFixed(),t.next=12,e.swapContract.methods.getKtmAmount(a).call();case 12:c=t.sent,e.ktmAmount=new K.a(c).multipliedBy(e.pickerValue.rate).dividedBy(1e4).dividedBy(Math.pow(10,r)).toFixed(2);case 14:case"end":return t.stop()}}),t)}))),1e3)});e.address&&e.initContract(),Object(r["T"])((function(){return e.address}),(function(t){t&&e.initContract()}));var n=Object(r["Q"])(e);return Object(O["a"])({},n)}},S=(n("a0f4"),n("6b0d")),E=n.n(S);const I=E()(N,[["render",v],["__scopeId","data-v-21b953f2"]]);e["default"]=I},"422b":function(t,e,n){},"4e82":function(t,e,n){"use strict";var r=n("23e7"),a=n("e330"),c=n("59ed"),o=n("7b0b"),i=n("07fa"),s=n("577e"),u=n("d039"),l=n("addb"),d=n("a640"),p=n("04d1"),b=n("d998"),f=n("2d00"),m=n("512c"),w=[],h=a(w.sort),k=a(w.push),v=u((function(){w.sort(void 0)})),O=u((function(){w.sort(null)})),j=d("sort"),g=!u((function(){if(f)return f<70;if(!(p&&p>3)){if(b)return!0;if(m)return m<603;var t,e,n,r,a="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)w.push({k:e+r,v:n})}for(w.sort((function(t,e){return e.v-t.v})),r=0;r<w.length;r++)e=w[r].k.charAt(0),a.charAt(a.length-1)!==e&&(a+=e);return"DGBEFHACIJK"!==a}})),x=v||!O||!j||!g,A=function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:s(e)>s(n)?1:-1}};r({target:"Array",proto:!0,forced:x},{sort:function(t){void 0!==t&&c(t);var e=o(this);if(g)return void 0===t?h(e):h(e,t);var n,r,a=[],s=i(e);for(r=0;r<s;r++)r in e&&k(a,e[r]);l(a,A(t)),n=a.length,r=0;while(r<n)e[r]=a[r++];while(r<s)delete e[r++];return e}})},"512c":function(t,e,n){var r=n("342f"),a=r.match(/AppleWebKit\/(\d+)\./);t.exports=!!a&&+a[1]},a0f4:function(t,e,n){"use strict";n("422b")},addb:function(t,e,n){var r=n("4dae"),a=Math.floor,c=function(t,e){var n=t.length,s=a(n/2);return n<8?o(t,e):i(t,c(r(t,0,s),e),c(r(t,s),e),e)},o=function(t,e){var n,r,a=t.length,c=1;while(c<a){r=c,n=t[c];while(r&&e(t[r-1],n)>0)t[r]=t[--r];r!==c++&&(t[r]=n)}return t},i=function(t,e,n,r){var a=e.length,c=n.length,o=0,i=0;while(o<a||i<c)t[o+i]=o<a&&i<c?r(e[o],n[i])<=0?e[o++]:n[i++]:o<a?e[o++]:n[i++];return t};t.exports=c},d998:function(t,e,n){var r=n("342f");t.exports=/MSIE|Trident/.test(r)}}]);
//# sourceMappingURL=chunk-62a88c09.6da5f863.js.map