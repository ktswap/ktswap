{"version":3,"sources":["webpack:///./src/views/market/index.vue?c13b","webpack:///./src/views/market/index.vue","webpack:///./src/views/market/index.vue?44c8"],"names":["class","_createElementVNode","_createBlock","_component_van_list","loading","_ctx","$event","immediate-check","error","error-text","finished","finished-text","onLoad","_createVNode","_component_HeadTop","title","isShowTop","isSubHeader","_hoisted_3","_component_van_field","style","center","clearable","label","placeholder","extra","_hoisted_4","_hoisted_5","_toDisplayString","Number","_component_van_button","type","size","loading-text","block","onClick","_hoisted_16","_createElementBlock","_Fragment","_renderList","item","index","key","kttAmount","_hoisted_21","_hoisted_22","price","_hoisted_25","_hoisted_28","haveSellAmount","_hoisted_31","remainAmount","_hoisted_34","_component_van_dialog","show","showConfirmButton","_hoisted_37","_component_van_icon","name","color","_hoisted_38","swaploading","components","HeadTop","setup","store","useStore","data","reactive","address","computed","state","accounts","web3","provider","marketContract","usdtContract","KttContract","usdtAllowance","usdtBalance","usdtAmount","ktmAmount","kttBalance","kttAllowance","btn","swapKttAmount","swapAmount","list","orderInfo","page","limit","initContract","eth","Contract","marketAbi","config","marketAddress","tokenAbi","usdtAddress","kttContract","kttAddress","initData","getBalance","getUsdtAllowance","getKttAllowance","getList","methods","decimals","call","kttDecimals","usdtDecimals","balanceOf","BigNumber","dividedBy","toFixed","allowance","approveUsdt","approve","MaxUint256","send","from","Toast","approveKtt","addBuyRecord","amount","multipliedBy","getUserRecords","info","recordArr","arr","forEach","id","push","minus","Math","ceil","total","toSell","sellKtt","sell","getOutAmount","_","throttle","watch","val","refData","toRefs","__exports__","render"],"mappings":"2IAAA,W,yuJCEOA,MAAM,Q,GAEJA,MAAM,a,uBACPC,eAA4B,OAAvBD,MAAM,SAAQ,OAAG,M,uBAWxBC,eAA+B,QAAzBD,MAAM,UAAS,OAAG,M,uBAYxBC,eAAsC,QAAhCD,MAAM,UAAS,cAAU,M,GAG9BA,MAAM,gB,GACJA,MAAM,c,iBAAa,Q,iBAA+B,S,GAClDA,MAAM,c,iBAAa,Q,iBAAgC,S,GAGrDA,MAAM,c,iBAC0I,M,iBAChC,U,uBAGnHC,eAAiC,OAA5BD,MAAM,aAAY,QAAI,M,GAEpBA,MAAM,Y,GAEFA,MAAM,mB,GACJA,MAAM,sB,GACHA,MAAM,O,uBACXC,eAA+B,OAA1BD,MAAM,QAAO,WAAO,M,uBAE5BC,eAAwB,OAAnBD,MAAM,QAAM,Y,GACZA,MAAM,sB,GACHA,MAAM,c,uBACXC,eAA8B,OAAzBD,MAAM,QAAO,UAAM,M,GAGxBA,MAAM,U,GACHA,MAAM,mB,uBACRC,eAA4B,OAAvBD,MAAM,QAAO,QAAI,M,GACjBA,MAAM,S,GAERA,MAAM,mB,uBACTC,eAA4B,OAAvBD,MAAM,QAAO,QAAI,M,GACjBA,MAAM,S,GAGXA,MAAM,wB,uBACPC,eAAa,wB,iBACkF,S,GAK/FD,MAAM,0B,uBACTC,eAAa,wB,uBAWnBA,eAA+B,QAAzBD,MAAM,UAAS,OAAG,M,GAGvBA,MAAM,gB,GACHA,MAAM,c,iBAAa,S,iBAA4C,Q,GAChEA,MAAM,c,iBAAa,Q,iBAA+B,Q,GAGpDA,MAAM,c,iBACgM,M,iBAC1B,S,6OA9FlLE,eAmGeC,GAAA,CAnGGC,QAASC,U,kDAAAA,UAAOC,IAAGC,mBAAiB,EAAeC,MAAOH,Q,gDAAAA,QAAKC,IAAEG,aAAW,cAAeC,SAAUL,WAAUM,gBAAc,QAASC,OAAMP,UAA9J,C,wBACC,iBAiGM,CAjGNJ,eAiGM,MAjGN,EAiGM,CAhGJY,eAAuEC,GAAA,CAA9DC,MAAM,OAAQC,WAAW,EAAOC,aAAa,IACtDhB,eAoCM,MApCN,EAoCM,CAnCFiB,EACEL,eAYIM,GAAA,CAXJC,MAAA,yB,WACGf,gB,sDAAAA,gBAAaC,IAIDD,gBAHrBgB,OAAA,GACAC,UAAA,GACAC,MAAM,GAENC,YAAY,WAPN,CASKC,MAAK,gBACd,iBAA+B,CAA/BC,M,KAVI,wCAaNb,eAWUM,GAAA,C,WAVDd,Q,sDAAAA,QAAKC,IAIOD,gBAHrBgB,OAAA,GACAC,UAAA,GACAC,MAAM,GAENC,YAAY,SANZ,CAQWC,MAAK,gBACd,iBAAsC,CAAtCE,M,KATF,wCAYF1B,eAGM,MAHN,EAGM,CAFJA,eAAkE,MAAlE,EAAkE,GAAtCA,eAA2B,YAAA2B,eAAnBvB,cAAU,GAAoB,IAClEJ,eAAmE,MAAnE,EAAmE,GAAvCA,eAA4B,YAAA2B,eAApBvB,eAAW,GAAoB,MAGrEJ,eAGM,MAHN,EAGM,CAF8F4B,OAAOxB,gBAAa,IAAd,iBAAvGH,eAAiK4B,GAAA,C,MAArJC,KAAK,UAAW3B,QAASC,MAAID,QAAS4B,KAAK,QAAQC,eAAa,SAASC,MAAA,GAAwCC,QAAO9B,gBAApI,C,wBAAkJ,iBAAE,O,KAApJ,4CACAH,eAAqI4B,GAAA,C,MAAzHC,KAAK,UAAW3B,QAASC,MAAID,QAAgB4B,KAAK,QAAQC,eAAa,UAAWE,QAAO9B,eAArG,C,wBAAkH,iBAAM,O,KAAxH,8BAGD+B,EAEEnC,eA4BI,MA5BJ,EA4BI,qBA3BHoC,eA0BMC,OAAA,KAAAC,eA1BoClC,QAAI,SAApBmC,EAAMC,G,wBAAhCJ,eA0BM,OA1BDrC,MAAM,OAAsC0C,IAAKD,GAAtD,CACGxC,eAUM,MAVN,EAUM,CATJA,eAGM,MAHN,EAGM,CAFHA,eAAyC,MAAzC,EAAyC2B,eAAtBY,EAAKG,WAAS,GACjCC,IAEHC,EACA5C,eAGM,MAHN,EAGM,CAFHA,eAAgD,MAAhD,EAAgD2B,eAAtBY,EAAKM,OAAO,OAAI,GAC1CC,MAGL9C,eASM,MATN,EASM,CARHA,eAGM,MAHN,EAGM,CAFH+C,EACA/C,eAAmD,MAAnD,EAAmD2B,eAA9BY,EAAKS,gBAAgB,MAAG,KAE/ChD,eAGK,MAHL,EAGK,CAFHiD,EACAjD,eAAiD,MAAjD,EAAiD2B,eAA5BY,EAAKW,cAAc,MAAG,OAGhDlD,eAGM,MAHN,EAGM,CAFFmD,EACCvC,eAAgHiB,GAAA,CAApGC,KAAK,UAAU/B,MAAM,YAAYoB,MAAA,gBAAqBc,MAAA,GAAOC,QAAK,mBAAE9B,SAAOmC,KAAvF,C,wBAA8F,iBAAK,O,KAAnG,yBAxBT,QA4BH3B,eAyBWwC,GAAA,CAzBSC,KAAMjD,O,+CAAAA,OAAIC,IAAEN,MAAM,YAAauD,mBAAmB,EAAOnC,MAAA,cAAoBL,MAAO,IAAxG,C,wBACM,iBAGM,CAHNd,eAGM,MAHN,EAGM,CAFJuD,EACA3C,eAAqE4C,GAAA,CAA1DtB,QAAK,+BAAE9B,QAAI,IAAQqD,KAAK,QAAQC,MAAM,OAAO3B,KAAK,WAE/DnB,eAUIM,GAAA,C,WATDd,a,qDAAAA,aAAUC,IACnBe,OAAA,GACAC,UAAA,GACAC,MAAM,GACNC,YAAY,WALN,CAOKC,MAAK,gBACd,iBAA+B,CAA/BmC,M,KARI,kBAWR3D,eAGM,MAHN,EAGM,CAFHA,eAA8E,MAA9E,EAA8E,GAAjDA,eAAuC,YAAA2B,eAA/BvB,YAAU8C,cAAY,GAAmB,IAC/ElD,eAAiE,MAAjE,EAAiE,GAArCA,eAA2B,YAAA2B,eAAnBvB,cAAU,GAAmB,MAGnEJ,eAGM,MAHN,EAGM,CAF0J4B,OAAOxB,gBAAY,oBAAjLH,eAAwN4B,GAAA,C,MAA5M6B,MAAM,mDAAmD5B,KAAK,UAAW3B,QAASC,MAAIwD,YAAa7B,KAAK,QAAQC,eAAa,SAASC,MAAA,GAAuCC,QAAO9B,WAAhM,C,wBAAyM,iBAAE,O,KAA3M,4CACCH,eAAgM4B,GAAA,C,MAApL6B,MAAM,mDAAmD5B,KAAK,UAAW3B,QAASC,MAAIwD,YAAoB7B,KAAK,QAAQC,eAAa,UAAWE,QAAO9B,cAAlK,C,wBAA8K,iBAAK,O,KAAnL,gC,KAvBD,kB,KAvEH,2C,mNAiHc,I,UAAA,CACbyD,WAAY,CACVC,iBAEFC,MAJa,WAKX,IAAMC,EAAQC,kBACRC,EAAOC,eAAS,CACpBC,QAASC,gBAAS,kBAAML,EAAMM,MAAMC,SAAS,MAC7CC,KAAMH,gBAAS,kBAAML,EAAMM,MAAMG,YACjCC,eAAgB,KAChBC,aAAc,KACdC,YAAa,KACbC,cAAe,GACfC,YAAa,OACbC,WAAY,OACZrC,UAAW,OACXsC,UAAW,OACXC,WAAY,OACZC,aAAc,GACdrC,MAAO,GACNsC,IAAK,CACJhF,SAAS,EACTyD,aAAa,GAEfwB,cAAe,GACfC,WAAY,GACZC,KAAM,GACNjC,MAAM,EACNkC,UAAW,KACXC,KAAM,EACNC,MAAO,EACPtF,SAAS,EACTI,OAAO,EACPE,UAAU,EACViF,aAAc,WACZxB,EAAKQ,eAAiB,IAAIR,EAAKM,KAAKmB,IAAIC,SAASC,GAAWC,QAAOC,eACnE7B,EAAKS,aAAe,IAAIT,EAAKM,KAAKmB,IAAIC,SAASI,GAAUF,QAAOG,aAChE/B,EAAKgC,YAAc,IAAIhC,EAAKM,KAAKmB,IAAIC,SAASI,GAAUF,QAAOK,YAC/DjC,EAAKkC,YAEPA,SAAU,WACRlC,EAAKmC,aACLnC,EAAKoC,mBACLpC,EAAKqC,kBACLrC,EAAKoB,KAAO,GACZpB,EAAKsB,KAAO,EACZtB,EAAKsC,WAEL7F,OA1CkB,WA2ClBuD,EAAKsB,OACLtB,EAAKsC,WAEPH,WAAY,WAAF,+CAAE,0HACcnC,EAAKgC,YAAYO,QAAQC,WAAWC,OADlD,cACNC,EADM,gBAEe1C,EAAKS,aAAa8B,QAAQC,WAAWC,OAFpD,cAENE,EAFM,gBAGa3C,EAAKgC,YAAYO,QAAQK,UAAU5C,EAAKE,SAASuC,OAH9D,cAGN1B,EAHM,iBAIcf,EAAKS,aAAa8B,QAAQK,UAAU5C,EAAKE,SAASuC,OAJhE,QAIN7B,EAJM,OAKVZ,EAAKe,WAAc,IAAI8B,KAAU9B,GAAY+B,UAA1B,SAAoC,GAAMJ,IAAaK,QAAQ,GAClF/C,EAAKY,YAAe,IAAIiC,KAAUjC,GAAakC,UAA3B,SAAqC,GAAMH,IAAcI,QAAQ,GAN3E,4CAAF,qDAAE,GAQZX,iBAAkB,WAAF,+CAAE,oHACMpC,EAAKS,aAAa8B,QAAQS,UAAUhD,EAAKE,QAAS0B,QAAOC,eAAeY,OAD9E,OACZO,EADY,OAEhBhD,EAAKW,cAAgBqC,EAFL,2CAAF,qDAAE,GAIjBX,gBAAiB,WAAF,+CAAE,oHACMrC,EAAKgC,YAAYO,QAAQS,UAAUhD,EAAKE,QAAS0B,QAAOC,eAAeY,OAD7E,OACZO,EADY,OAEhBhD,EAAKgB,aAAegC,EAFJ,2CAAF,qDAAE,GAKlBC,YAAa,WAAF,+CAAE,qGACXjD,EAAKiB,IAAIhF,SAAU,EADR,kBAGH+D,EAAKS,aAAa8B,QAAQW,QAAQtB,QAAOC,cAAesB,SAAYC,KAAK,CAACC,KAAMrD,EAAKE,UAHlF,OAIToD,gBAAM,QACNtD,EAAKoC,mBACLpC,EAAKiB,IAAIhF,SAAU,EANV,mDAQTqH,gBAAM,QACNtD,EAAKiB,IAAIhF,SAAU,EATV,yDAAF,qDAAE,GAabsH,WAAY,WAAF,+CAAE,qGACVvD,EAAKiB,IAAIvB,aAAc,EADb,kBAGFM,EAAKgC,YAAYO,QAAQW,QAAQtB,QAAOC,cAAesB,SAAYC,KAAK,CAACC,KAAMrD,EAAKE,UAHlF,OAIRoD,gBAAM,QACNtD,EAAKqC,kBACLrC,EAAKiB,IAAIvB,aAAc,EANf,mDAQR4D,gBAAM,QACNtD,EAAKiB,IAAIvB,aAAc,EATf,yDAAF,qDAAE,GAaZ8D,aAAc,WAAF,+CAAE,6GACRxD,EAAKkB,cADG,uBAEVoC,gBAAM,UAFI,6BAKRtD,EAAKrB,MALG,uBAMV2E,gBAAM,UANI,+BAST5F,OAAOsC,EAAKa,YAAcnD,OAAOsC,EAAKY,cAT7B,uBAUV0C,gBAAM,YAVI,iCAcXtD,EAAKiB,IAAIhF,SAAU,EAdR,oBAgBW+D,EAAKgC,YAAYO,QAAQC,WAAWC,OAhB/C,eAgBND,EAhBM,iBAiBexC,EAAKS,aAAa8B,QAAQC,WAAWC,OAjBpD,eAiBNE,EAjBM,OAkBNc,EAAS,IAAIZ,KAAU7C,EAAKkB,eAAewC,aAAlC,SAA+C,GAAMlB,IAAUO,UACxEpE,EAAQ,IAAIkE,KAAU7C,EAAKrB,OAAO+E,aAA1B,SAAuC,GAAMf,IAAcI,UAnB7D,UAoBJ/C,EAAKQ,eAAe+B,QAAQiB,aAAaC,EAAQ9E,GAAOyE,KAAK,CAACC,KAAMrD,EAAKE,UApBrE,QAqBVoD,gBAAM,QACNtD,EAAKkC,WACLlC,EAAKiB,IAAIhF,SAAU,EAvBT,sDAyBVqH,gBAAM,QACNtD,EAAKiB,IAAIhF,SAAU,EA1BT,2DAAF,qDAAE,GA6BdqG,QAAS,WAAF,+CAAE,0HAEUtC,EAAKQ,eAAe+B,QAAQoB,eAAe3D,EAAKsB,KAAKtB,EAAKuB,OAAOkB,KAAK,CAACY,KAAMrD,EAAKE,UAF5F,OAEH0D,EAFG,OAGHxC,EAAOwC,EAAKC,UAEZC,EAAM,GACT1C,EAAK2C,SAAQ,SAAC1F,GACVX,OAAOW,EAAK2F,IAAM,GACnBF,EAAIG,KAAK,CACPzF,UAAY,IAAIqE,KAAUxE,EAAKG,WAAWsE,UAA9B,SAAwC,GAAI,KAAIC,QAAQ,GACpEjE,eAAiB,IAAI+D,KAAUxE,EAAKS,gBAAgBgE,UAAnC,SAA6C,GAAI,KAAIC,QAAQ,GAC9EpE,MAAO,IAAIkE,KAAUxE,EAAKM,OAAOmE,UAA1B,SAAoC,GAAI,KAAIC,QAAQ,GAC3DiB,GAAG3F,EAAK2F,GACRhF,aAAc,IAAI6D,KAAUxE,EAAKG,WAAW0F,MAAM7F,EAAKS,gBAAgBgE,UAAzD,SAAmE,GAAI,KAAIC,QAAQ,QAInF,IAAd/C,EAAKsB,KACPtB,EAAKoB,KAAO0C,GAEZ,EAAA9D,EAAKoB,MAAK6C,KAAV,QAAkBH,GAEpB9D,EAAK/D,SAAU,EACf+D,EAAKzD,WAAa4H,KAAKC,KAAKR,EAAKS,MAAQrE,EAAKuB,OAASvB,EAAKsB,MAvBvD,4CAAF,qDAAE,GAyBTgD,OAAQ,SAACjG,GACP2B,EAAKb,MAAO,EACZa,EAAKqB,UAAYhD,GAEnBkG,QAAS,WAAF,+CAAE,yGACHvE,EAAKmB,WADF,uBAELmC,gBAAM,UAFD,+BAKJ5F,OAAOsC,EAAKmB,YAAczD,OAAOsC,EAAKe,aALlC,uBAMLuC,gBAAM,WAND,iCASNtD,EAAKiB,IAAIvB,aAAc,EATjB,SAUgBM,EAAKgC,YAAYO,QAAQC,WAAWC,OAVpD,cAUDD,EAVC,OAWDiB,EAAS,IAAIZ,KAAU7C,EAAKmB,YAAYuC,aAA/B,SAA4C,GAAMlB,IAAUO,UAXpE,oBAaC/C,EAAKQ,eAAe+B,QAAQiC,KAAKxE,EAAKqB,UAAU2C,GAAGP,GAAQL,KAAK,CAACC,KAAMrD,EAAKE,UAb7E,QAcLoD,gBAAM,QACLtD,EAAKkC,WACLlC,EAAKb,MAAO,EACba,EAAKiB,IAAIvB,aAAc,EAjBlB,sDAmBL4D,gBAAM,QACLtD,EAAKb,MAAO,EACba,EAAKiB,IAAIvB,aAAc,EArBlB,2DAAF,qDAAE,GAwBT+E,aAAcC,KAAEC,SAAF,yCAAW,uGAClB3E,EAAKkB,eAAgD,GAA/BxD,OAAOsC,EAAKkB,gBAAyBlB,EAAKrB,OAA6B,GAApBjB,OAAOsC,EAAKrB,OADnE,yCAEd,QAFc,OAInBkC,EAAa,IAAIgC,KAAU7C,EAAKkB,eAAewC,aAAa1D,EAAKrB,OAAOoE,QAAQ,GACpF/C,EAAKa,WAAaA,EALK,2CAMtB,OAEDb,EAAKE,SACPF,EAAKwB,eAEPoD,gBAAM,kBAAM5E,EAAKE,WAAS,SAAC2E,GACrBA,GACF7E,EAAKwB,kBAGT,IAAMsD,EAAUC,eAAO/E,GACvB,OAAO,mBACF8E,M,oCC9ST,MAAME,GAA2B,KAAgB,GAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAE1E","file":"static/js/chunk-15362c13.7bb9c8dd.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=272168b5&lang=less&scoped=true\"","<template>\n <van-list v-model:loading=\"loading\" :immediate-check=\"false\" v-model:error=\"error\" error-text=\"请求失败，点击重新加载\" :finished=\"finished\" finished-text=\"没有更多了\" @load=\"onLoad\">\n  <div class=\"swap\">\n    <HeadTop title=\"买单市场\" :isShowTop=\"true\" :isSubHeader=\"false\"></HeadTop>\n    <div class=\"swap-item\">\n        <div class=\"title\">挂买单</div>\n          <van-field\n          style=\"margin-bottom: 12px\"\n    v-model=\"swapKttAmount\"\n    center\n    clearable\n    label=\"\"\n    @update:model-value=\"getOutAmount\"\n    placeholder=\"请输入购买数量\"\n  >\n    <template #extra>\n      <span class=\"sympol\">KTT</span>\n    </template>\n  </van-field>\n    <van-field\n    v-model=\"price\"\n    center\n    clearable\n    label=\"\"\n    @update:model-value=\"getOutAmount\"\n    placeholder=\"请输入单价\"\n  >\n    <template #extra>\n      <span class=\"sympol\">USDT / KTT</span>\n    </template>\n  </van-field>\n  <div class=\"flex-between\">\n    <div class=\"price-desc\">需要： <span>{{usdtAmount}}</span> USDT</div>\n    <div class=\"price-desc\">余额： <span>{{usdtBalance}}</span> USDT</div>\n  </div>\n  \n  <div class=\"button-box\">\n     <van-button type=\"primary\" :loading=\"btn.loading\" size=\"large\" loading-text=\"兑换中...\" block v-if=\"Number(usdtAllowance > 0)\" @click=\"addBuyRecord\">挂单</van-button>\n     <van-button type=\"primary\" :loading=\"btn.loading\" v-else size=\"large\" loading-text=\"正在授权...\" @click=\"approveUsdt\">授权USDT</van-button>\n  </div>\n    </div>\n    <div class=\"title-sub\">所有挂单</div>\n  \n      <div class=\"list-box\">\n       <div class=\"item\" v-for=\"(item, index) in list\" :key=\"index\">\n          <div class=\"top flex-middle\">\n            <div class=\"top-item flex-item\">\n               <div class=\"num\">{{item.kttAmount}}</div>\n               <div class=\"desc\">买入KTT数量</div>\n            </div>\n            <div class=\"line\"></div>\n            <div class=\"top-item flex-item\">\n               <div class=\"num yellow\">{{item.price}}USDT</div>\n               <div class=\"desc\">价格/KTT</div>\n            </div>\n          </div>\n          <div class=\"bottom\">\n             <div class=\"row flex-middle\">\n                <div class=\"name\">卖出数量</div>\n                <div class=\"value\">{{item.haveSellAmount}}KTT</div>\n             </div>\n              <div class=\"row flex-middle\">\n                <div class=\"name\">剩余数量</div>\n                <div class=\"value\">{{item.remainAmount}}KTT</div>\n             </div>\n          </div>\n           <div class=\"btn-box flex-between\">\n               <span></span>\n                <van-button type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block @click=\"toSell(item)\">卖出KTT</van-button>\n           </div>\n       </div>\n    </div>\n    <van-dialog v-model:show=\"show\" class=\"swap-item\" :showConfirmButton=\"false\" style=\"padding: 0\" :title=\"''\">\n          <div class=\"close-box flex-between\">\n            <span></span>\n            <van-icon @click=\"show=false\" name=\"cross\" color=\"#fff\" size=\"20px\"/>\n          </div>\n          <van-field\n    v-model=\"swapAmount\"\n    center\n    clearable\n    label=\"\"\n    placeholder=\"请输入卖出数量\"\n  >\n    <template #extra>\n      <span class=\"sympol\">KTT</span>\n    </template>\n  </van-field>\n  <div class=\"flex-between\">\n     <div class=\"price-desc\">可卖出: <span>{{orderInfo.remainAmount}}</span> KTT</div>\n    <div class=\"price-desc\">余额: <span>{{kttBalance}}</span> KTT</div>\n  </div>\n  \n  <div class=\"button-box\">\n    <van-button color=\"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)\" type=\"primary\" :loading=\"btn.swaploading\" size=\"large\" loading-text=\"兑换中...\" block v-if=\"Number(kttAllowance) > 0\" @click=\"sellKtt\">卖出</van-button>\n     <van-button color=\"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)\" type=\"primary\" :loading=\"btn.swaploading\" v-else size=\"large\" loading-text=\"正在授权...\" @click=\"approveKtt\">授权KTT</van-button>\n  </div>\n  </van-dialog>\n\n  </div>\n     </van-list>\n</template>\n<script>\nimport HeadTop from '@/components/HeadTop'\nimport { reactive, toRefs, computed, watch } from \"vue\";\nimport { useStore } from \"vuex\";\nimport { MaxUint256 } from \"@ethersproject/constants\";\nimport BigNumber from 'bignumber.js';\nimport _ from 'lodash'\nimport marketAbi from \"@/utils/marketAbi\";\nimport tokenAbi from \"@/utils/abi\";\nimport config from \"@/utils/config\";\nimport { Toast } from 'vant';\nimport dateformat from \"dateformat\"\nexport default {\n  components: {\n    HeadTop\n  },\n  setup () {\n    const store = useStore()\n    const data = reactive({\n      address: computed(() => store.state.accounts[0]),\n      web3: computed(() => store.state.provider),\n      marketContract: null,\n      usdtContract: null,\n      KttContract: null,\n      usdtAllowance: '',\n      usdtBalance: '0.00',\n      usdtAmount: '0.00',\n      kttAmount: '0.00',\n      ktmAmount: '0.00',\n      kttBalance: '0.00',\n      kttAllowance: '',\n      price: '',\n       btn: {\n        loading: false,\n        swaploading: false\n      },\n      swapKttAmount: '',\n      swapAmount: '',\n      list: [],\n      show: false,\n      orderInfo: null,\n      page: 1,\n      limit: 5,\n      loading: false,\n      error: false,\n      finished: false,\n      initContract: () => {\n        data.marketContract = new data.web3.eth.Contract(marketAbi, config.marketAddress)\n        data.usdtContract = new data.web3.eth.Contract(tokenAbi, config.usdtAddress)\n        data.kttContract = new data.web3.eth.Contract(tokenAbi, config.kttAddress)\n        data.initData()\n      },\n      initData: () => {\n        data.getBalance()\n        data.getUsdtAllowance()\n        data.getKttAllowance()\n        data.list = []\n        data.page = 1\n        data.getList()\n      },\n        onLoad () {\n        data.page++\n        data.getList()\n      },\n      getBalance: async () => {\n        let kttDecimals = await data.kttContract.methods.decimals().call()\n        let usdtDecimals = await data.usdtContract.methods.decimals().call()\n        let kttBalance = await data.kttContract.methods.balanceOf(data.address).call()\n        let usdtBalance = await data.usdtContract.methods.balanceOf(data.address).call()\n        data.kttBalance =  new BigNumber(kttBalance).dividedBy(10 ** kttDecimals).toFixed(2)\n        data.usdtBalance =  new BigNumber(usdtBalance).dividedBy(10 ** usdtDecimals).toFixed(2)\n      },\n      getUsdtAllowance: async () => {\n        let allowance = await data.usdtContract.methods.allowance(data.address, config.marketAddress).call()\n        data.usdtAllowance = allowance;\n      },\n       getKttAllowance: async () => {\n        let allowance = await data.kttContract.methods.allowance(data.address, config.marketAddress).call()\n        data.kttAllowance = allowance;\n        console.log(allowance, '-----------allowance')\n      },\n      approveUsdt: async () => {\n        data.btn.loading = true\n        try {\n          await data.usdtContract.methods.approve(config.marketAddress, MaxUint256).send({from: data.address})\n          Toast('授权成功')\n          data.getUsdtAllowance()\n          data.btn.loading = false\n        } catch (error) {\n          Toast('授权失败')\n          data.btn.loading = false\n        }\n        \n      },\n      approveKtt: async () => {\n        data.btn.swaploading = true\n        try {\n          await data.kttContract.methods.approve(config.marketAddress, MaxUint256).send({from: data.address})\n          Toast('授权成功')\n          data.getKttAllowance()\n          data.btn.swaploading = false\n        } catch (error) {\n          Toast('授权失败')\n          data.btn.swaploading = false\n        }\n        \n      },\n      addBuyRecord: async () => {\n        if(!data.swapKttAmount) {\n          Toast('请先输入数量')\n          return\n        }\n        if(!data.price) {\n          Toast('请先输入价格')\n          return\n        }\n        if(Number(data.usdtAmount) > Number(data.usdtBalance)) {\n          Toast('USDT余额不足')\n          return\n        }\n        \n         data.btn.loading = true\n        try {\n          let decimals = await data.kttContract.methods.decimals().call()\n          let usdtDecimals = await data.usdtContract.methods.decimals().call()\n          let amount = new BigNumber(data.swapKttAmount).multipliedBy(10 ** decimals).toFixed()\n          let price = new BigNumber(data.price).multipliedBy(10 ** usdtDecimals).toFixed()\n          await data.marketContract.methods.addBuyRecord(amount, price).send({from: data.address})\n          Toast('挂单成功')\n          data.initData()\n          data.btn.loading = false\n        } catch (error) {\n          Toast('挂单失败')\n          data.btn.loading = false\n        }\n      },\n      getList: async () => {\n        console.log(data.page,data.limit)\n        let info = await data.marketContract.methods.getUserRecords(data.page,data.limit).call({from: data.address})\n        let list = info.recordArr\n        console.log(info)\n        let arr = []\n         list.forEach((item) => {\n          if(Number(item.id) > 0) {\n            arr.push({\n              kttAmount:  new BigNumber(item.kttAmount).dividedBy(10**18).toFixed(2),\n              haveSellAmount:  new BigNumber(item.haveSellAmount).dividedBy(10**18).toFixed(2),\n              price: new BigNumber(item.price).dividedBy(10**18).toFixed(2),\n              id:item.id,\n              remainAmount: new BigNumber(item.kttAmount).minus(item.haveSellAmount).dividedBy(10**18).toFixed(2),\n            })\n          }\n        })\n          if (data.page === 1) {\n            data.list = arr\n          } else {\n            data.list.push(...arr)\n          }\n          data.loading = false\n          data.finished = !(Math.ceil(info.total / data.limit) > data.page)\n      },\n      toSell: (item) => {\n        data.show = true\n        data.orderInfo = item\n      },\n      sellKtt: async () => {\n        if(!data.swapAmount) {\n          Toast('请先输入数量')\n          return\n        }\n        if(Number(data.swapAmount) > Number(data.kttBalance)) {\n          Toast('KTT余额不足')\n          return\n        }\n         data.btn.swaploading = true\n          let decimals = await data.kttContract.methods.decimals().call()\n          let amount = new BigNumber(data.swapAmount).multipliedBy(10 ** decimals).toFixed()\n        try {\n          await data.marketContract.methods.sell(data.orderInfo.id,amount).send({from: data.address})\n          Toast('卖出成功')\n           data.initData()\n           data.show = false\n          data.btn.swaploading = false\n        } catch (error) {\n          Toast('卖出失败')\n           data.show = false\n          data.btn.swaploading = false\n        }\n      },\n      getOutAmount: _.throttle(async function(){\n        if (!data.swapKttAmount || Number(data.swapKttAmount)  == 0 || !data.price || Number(data.price)==0) {\n          return '0.00'\n        }\n        let usdtAmount = new BigNumber(data.swapKttAmount).multipliedBy(data.price).toFixed(2)\n        data.usdtAmount = usdtAmount\n      }, 1000)\n    })\n    if (data.address) {\n      data.initContract()\n    }\n    watch(() => data.address, (val) => {\n      if (val) {\n        data.initContract()\n      }\n    })\n    const refData = toRefs(data);\n    return {\n      ...refData\n    };\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.swap{\n  padding: 16px;\n}\n.sympol{\n    font-size: 14px;\n}\n.swap-item{\n  background: #3F2E6F;\n  border-radius: 5px;\n  padding: 20px 14px;\n  margin-bottom: 15px;\n  .title{\n    text-align: center;\n    color: #fff;\n    font-size: 16px;\n    font-weight: 600;\n    margin-bottom: 20px;\n  }\n  .price-desc{\n    font-size: 12px;\n    font-weight: 600;\n    color: #E4D7FF;\n    margin: 15px 8px;\n    span{\n      color: #FFD511;\n    }\n  }\n}\n.title-sub{\n  font-size: 16px;\n  font-weight: 700;\n  margin: 20px 0;\n  color: #fff;\n}\n  .list-box{\n    padding-top: 20px;\n    .item{\n      background: #3F2E6F;\n    box-shadow: 0px 4px 0px 0px #3F2E6F;\n    border-radius: 15px;\n    padding: 25px 20px;\n    margin-bottom: 20px;\n      .top{\n          padding-bottom: 20px;\n          border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);\n        .top-item{\n          .num{\n            color: #fff;\n            font-size: 18px;\n            font-weight: 700;\n            margin-bottom: 4px;\n          }\n          .yellow{\n            color: #FFD511;\n          }\n          .desc{\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 14px;\n          }\n        }\n        .line{\n          width: 0.5px;\n          height: 40px;\n          background: rgba(255, 255, 255, 0.1);\n          margin-right: 18px;\n        }\n      }\n      .bottom{\n        padding: 18px 0 0;\n        .status{\n          color: #0CD3DD;\n          font-size: 16px;\n          font-weight: 700;\n          padding-bottom: 4px;\n        }\n        .red{\n          color: #F3489D;\n        }\n        .row{\n          margin-top: 10px;\n          .name{\n            width: 110px;\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 14px;\n          }\n          .value{\n            color: #fff;\n            font-size: 14px;\n          }\n        }\n      }\n      .btn-box{\n        margin-top: 16px;\n      }\n    }\n  }\n  .close-box{\n    margin-bottom: 20px;\n    margin-top: -6px;\n  }\n</style>\n","import { render } from \"./index.vue?vue&type=template&id=272168b5&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=272168b5&lang=less&scoped=true\"\n\nimport exportComponent from \"/Users/wangyouquan/priviteProject/ketai/ketai-vue/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-272168b5\"]])\n\nexport default __exports__"],"sourceRoot":""}