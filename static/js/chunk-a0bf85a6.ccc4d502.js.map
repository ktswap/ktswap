{"version":3,"sources":["webpack:///./src/views/reward/index.vue","webpack:///./src/views/reward/index.vue?0a65","webpack:///./src/views/reward/index.vue?d97e"],"names":["class","_createElementVNode","_createElementBlock","_createVNode","_component_HeadTop","title","isShowTop","isSubHeader","_component_van_list","loading","_ctx","$event","immediate-check","error","error-text","finished","finished-text","onLoad","_Fragment","_renderList","item","index","key","_toDisplayString","stakeKttAmount","_hoisted_6","_hoisted_7","totalRewardKtm","_hoisted_10","isValid","isCanTake","_hoisted_16","lockTime","_hoisted_19","stakeTime","_hoisted_22","endTime","_hoisted_25","_component_van_button","type","style","block","onClick","id","components","HeadTop","setup","store","useStore","data","reactive","address","computed","state","accounts","web3","provider","swapContract","page","limit","list","initContract","eth","Contract","swapAbi","config","swapAddress","initData","getList","methods","getUserRewardRecords","call","from","info","periodTime","getBlockTimestamp","timestamp","records","arr","forEach","Number","push","BigNumber","dividedBy","toFixed","dayBackKtm","dateformat","Math","ceil","total","withdrawRewardStakeRecord","send","Toast","watch","val","refData","toRefs","__exports__","render"],"mappings":"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","file":"static/js/chunk-a0bf85a6.ccc4d502.js","sourcesContent":["<template>\n  <div class=\"swap-box invest-box\">\n    <HeadTop title=\"记录\" :isShowTop=\"true\" :isSubHeader=\"false\"></HeadTop>\n     <van-list v-model:loading=\"loading\" :immediate-check=\"false\" v-model:error=\"error\" error-text=\"请求失败，点击重新加载\" :finished=\"finished\" finished-text=\"没有更多了\" @load=\"onLoad\">\n    <div class=\"list-box\">\n       <div class=\"item\" v-for=\"(item, index) in list\" :key=\"index\">\n          <div class=\"top flex-middle\">\n            <div class=\"top-item flex-item\">\n               <div class=\"num\">{{item.stakeKttAmount}}</div>\n               <div class=\"desc\">质押KTT</div>\n            </div>\n            <div class=\"line\"></div>\n            <div class=\"top-item flex-item\">\n               <div class=\"num yellow\">{{item.totalRewardKtm}}</div>\n               <div class=\"desc\">KTM总收益</div>\n            </div>\n          </div>\n          <div class=\"bottom\">\n            \n            <div class=\"status\" v-if=\"!item.isValid\">已领取</div>\n             <div class=\"status\" v-else-if=\"item.isCanTake\">可领取</div>\n             <div class=\"status red\" v-else>{{$t('未到期')}}</div>\n             <div class=\"row flex-middle\">\n                <div class=\"name\">时长</div>\n                <div class=\"value\">{{item.lockTime}}天</div>\n             </div>\n             <div class=\"row flex-middle\">\n                <div class=\"name\">质押时间</div>\n                <div class=\"value\">{{item.stakeTime}}</div>\n             </div>\n             <div class=\"row flex-middle\">\n                <div class=\"name\">质押到期时间</div>\n                <div class=\"value\">{{item.endTime}}</div>\n             </div>\n          </div>\n           <div class=\"btn-box flex-between\" v-if=\"item.isCanTake && item.isValid\">\n               <span></span>\n                <van-button type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block @click=\"withdrawRewardStakeRecord(item.id)\">领取</van-button>\n           </div>\n       </div>\n    </div>\n    </van-list>\n  </div>  \n</template>\n<script>\nimport HeadTop from '@/components/HeadTop'\nimport { reactive, toRefs, computed, watch } from \"vue\";\nimport { useStore } from \"vuex\";\nimport swapAbi from \"@/utils/swapAbi\";\nimport { Toast } from 'vant';\nimport config from \"@/utils/config\";\nimport BigNumber from 'bignumber.js';\nimport dateformat from \"dateformat\"\nexport default {\n  components: {\n    HeadTop\n  },\n  setup () {\n    const store = useStore()\n    const data = reactive({\n      address: computed(() => store.state.accounts[0]),\n      web3: computed(() => store.state.provider),\n      swapContract: null,\n      page: 1,\n      limit: 5,\n      loading: false,\n      error: false,\n      finished: false,\n      list: [],\n      initContract: () => {\n        data.swapContract = new data.web3.eth.Contract(swapAbi, config.swapAddress)\n        data.initData()\n      },\n      initData: () => {\n         data.list = []\n        data.page = 1\n        data.getList()\n      },\n        onLoad () {\n        data.page++\n        data.getList()\n      },\n      getList: async () => {\n        let info = await data.swapContract.methods.getUserRewardRecords(data.address,1,5).call({from: data.address})\n        let periodTime = await data.swapContract.methods.periodTime().call()\n        let timestamp = await data.swapContract.methods.getBlockTimestamp().call()\n        let list = info.records\n        let arr = []\n         list.forEach((item) => {\n          if(Number(item.id) > 0) {\n            arr.push({\n              stakeKttAmount:  new BigNumber(item.stakeKttAmount).dividedBy(10**18).toFixed(2),\n              totalRewardKtm:  new BigNumber(item.totalRewardKtm).dividedBy(10**18).toFixed(2),\n              dayBackKtm: new BigNumber(item.dayBackKtm).dividedBy(10**18).toFixed(2),\n              id:item.id,\n              isValid: item.isValid,\n              lockTime: new BigNumber(item.lockTime).dividedBy(periodTime).toFixed(1),\n              stakeTime: dateformat(item.stakeTime*1000, 'yyyy-mm-dd HH:MM:ss'),\n              endTime: dateformat((Number(item.stakeTime) + Number(item.lockTime))*1000, 'yyyy-mm-dd HH:MM:ss'),\n              isCanTake: Number(timestamp) >= Number(item.stakeTime) + Number(item.lockTime)\n            })\n          }\n        })\n          if (data.page === 1) {\n            data.list = arr\n          } else {\n            data.list.push(...arr)\n          }\n          data.loading = false\n          data.finished = !(Math.ceil(info.total / data.limit) > data.page)\n      },\n      withdrawRewardStakeRecord: async (id) => {\n        try {\n          await data.swapContract.methods.withdrawRewardStakeRecord(id).send({from: data.address})\n          Toast('领取成功')\n        } catch (error) {\n          Toast('领取失败')  \n        }\n        \n      } \n    })\n    if (data.address) {\n      data.initContract()\n    }\n    watch(() => data.address, (val) => {\n      if (val) {\n        data.initContract()\n      }\n    })\n    const refData = toRefs(data);\n    return {\n      ...refData\n    };\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.invest-box{\n  padding: 10px 16px 25px;\n  min-height: 100vh;\n  .list-box{\n    padding-top: 20px;\n    .item{\n      background: #3F2E6F;\n    box-shadow: 0px 4px 0px 0px #3F2E6F;\n    border-radius: 15px;\n    padding: 25px 20px;\n    margin-bottom: 20px;\n      .top{\n          padding-bottom: 20px;\n          border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);\n        .top-item{\n          .num{\n            color: #fff;\n            font-size: 18px;\n            font-weight: 700;\n            margin-bottom: 4px;\n          }\n          .yellow{\n            color: #FFD511;\n          }\n          .desc{\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 14px;\n          }\n        }\n        .line{\n          width: 0.5px;\n          height: 40px;\n          background: rgba(255, 255, 255, 0.1);\n          margin-right: 18px;\n        }\n      }\n      .bottom{\n        padding: 18px 0 0;\n        .status{\n          color: #0CD3DD;\n          font-size: 16px;\n          font-weight: 700;\n          padding-bottom: 4px;\n        }\n        .red{\n          color: #F3489D;\n        }\n        .row{\n          margin-top: 10px;\n          .name{\n            width: 110px;\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 14px;\n          }\n          .value{\n            color: #fff;\n            font-size: 14px;\n          }\n        }\n      }\n      .btn-box{\n        margin-top: 16px;\n      }\n    }\n  }\n}\n</style>\n","import { render } from \"./index.vue?vue&type=template&id=16e4aec8&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=16e4aec8&lang=less&scoped=true\"\n\nimport exportComponent from \"/Users/wangyouquan/priviteProject/ketai/ketai-vue/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-16e4aec8\"]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=16e4aec8&lang=less&scoped=true\""],"sourceRoot":""}