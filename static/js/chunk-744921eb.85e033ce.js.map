{"version":3,"sources":["webpack:///./src/views/sellMarket/index.vue?87b3","webpack:///./src/views/sellMarket/index.vue","webpack:///./src/views/sellMarket/index.vue?3f57"],"names":["class","_createElementVNode","_createBlock","_component_van_list","loading","_ctx","$event","immediate-check","error","error-text","finished","finished-text","onLoad","_createVNode","_component_HeadTop","title","isShowTop","isSubHeader","_hoisted_2","_createElementBlock","_Fragment","_renderList","item","index","key","_toDisplayString","kttAmount","_hoisted_7","_hoisted_8","price","_hoisted_11","_hoisted_14","buyer","substring","length","_hoisted_17","haveSellAmount","_hoisted_20","remainAmount","Number","_hoisted_23","isCancle","ownerAddress","_component_van_button","type","style","block","onClick","id","_component_van_dialog","show","showConfirmButton","_hoisted_28","_component_van_icon","name","color","size","_component_van_field","center","clearable","label","placeholder","extra","_hoisted_29","swaploading","loading-text","components","HeadTop","setup","store","useStore","data","reactive","address","computed","state","accounts","web3","provider","marketContract","usdtContract","KttContract","usdtAllowance","usdtBalance","usdtAmount","ktmAmount","kttBalance","kttAllowance","config","btn","swapKttAmount","swapAmount","list","orderInfo","page","limit","initContract","eth","Contract","marketAbi","sellMarketAddress","tokenAbi","usdtAddress","kttContract","kttAddress","initData","getBalance","getUsdtAllowance","getKttAllowance","getList","methods","decimals","call","kttDecimals","usdtDecimals","balanceOf","BigNumber","dividedBy","toFixed","allowance","approveUsdt","approve","MaxUint256","send","from","Toast","approveKtt","addBuyRecord","amount","multipliedBy","getUserRecords","info","recordArr","arr","forEach","push","minus","Math","ceil","total","toSell","sellKtt","sell","cancle","getOutAmount","_","throttle","watch","val","refData","toRefs","__exports__","render"],"mappings":"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","file":"static/js/chunk-744921eb.85e033ce.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=69b13cce&lang=less&scoped=true\"","<template>\n <van-list v-model:loading=\"loading\" :immediate-check=\"false\" v-model:error=\"error\" error-text=\"请求失败，点击重新加载\" :finished=\"finished\" finished-text=\"没有更多了\" @load=\"onLoad\">\n  <div class=\"swap\">\n    <HeadTop title=\"卖单市场\" :isShowTop=\"true\" :isSubHeader=\"false\"></HeadTop>\n    <!-- <div class=\"swap-item\">\n        <div class=\"title\">挂卖单</div>\n          <van-field\n          style=\"margin-bottom: 12px\"\n    v-model=\"swapKttAmount\"\n    center\n    clearable\n    label=\"\"\n    @update:model-value=\"getOutAmount\"\n    placeholder=\"请输入卖出数量\"\n  >\n    <template #extra>\n      <span class=\"sympol\">KTT</span>\n    </template>\n  </van-field>\n    <van-field\n    v-model=\"price\"\n    center\n    clearable\n    label=\"\"\n    @update:model-value=\"getOutAmount\"\n    placeholder=\"请输入单价\"\n  >\n    <template #extra>\n      <span class=\"sympol\">USDT / KTT</span>\n    </template>\n  </van-field>\n  <div class=\"flex-between\">\n\n    <div class=\"price-desc\">余额： <span>{{kttBalance}}</span> KTT</div>\n  </div>\n  <div style=\"margin-top: -20px\">\n   <div class=\"price-desc\">100KTT起步、100的整数倍挂卖</div> \n  </div>\n  \n  <div class=\"button-box\">\n     <van-button type=\"primary\" :loading=\"btn.loading\" size=\"large\" loading-text=\"兑换中...\" block v-if=\"Number(kttAllowance > 0)\" @click=\"addBuyRecord\">挂单</van-button>\n     <van-button type=\"primary\" :loading=\"btn.loading\" v-else size=\"large\" loading-text=\"正在授权...\" @click=\"approveKtt\">授权KTT</van-button>\n  </div>\n    </div> -->\n    <div class=\"title-sub\">所有挂单</div>\n  \n      <div class=\"list-box\">\n       <div class=\"item\"  v-show=\"Number(item.kttAmount) > Number(item.haveSellAmount)\" v-for=\"(item, index) in list\" :key=\"index\">\n          <div class=\"top flex-middle\">\n            <div class=\"top-item flex-item\">\n               <div class=\"num\">{{item.kttAmount}}</div>\n               <div class=\"desc\">卖出KTT数量</div>\n            </div>\n            <div class=\"line\"></div>\n            <div class=\"top-item flex-item\">\n               <div class=\"num yellow\">{{item.price}}USDT</div>\n               <div class=\"desc\">价格/KTT</div>\n            </div>\n          </div>\n          <div class=\"bottom\">\n            <div class=\"row flex-middle\">\n                <div class=\"name\">挂单地址</div>\n                <div class=\"value\">{{item.buyer.substring(0, 6) + '......' + item.buyer.substring(item.buyer.length - 6, item.buyer.length)}}</div>\n             </div>\n             <div class=\"row flex-middle\">\n                <div class=\"name\">已卖出数量</div>\n                <div class=\"value\">{{item.haveSellAmount}}KTT</div>\n             </div>\n              <div class=\"row flex-middle\">\n                <div class=\"name\">剩余数量</div>\n                <div class=\"value\">{{item.remainAmount}}KTT</div>\n             </div>\n          </div>\n           <div class=\"btn-box flex-between\" v-if=\"Number(item.kttAmount) > Number(item.haveSellAmount)\">\n               <span></span>\n                <van-button v-if=\"!item.isCancle && (item.buyer == address || address == config.ownerAddress)\" type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block @click=\"cancle(item.id)\">取消</van-button>\n                <van-button v-if=\"!item.isCancle\" type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block  @click=\"toSell(item)\">买入KTT</van-button>\n                <van-button v-if=\"item.isCancle\" type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block >已取消</van-button>\n           </div>\n       </div>\n    </div>\n    <van-dialog v-model:show=\"show\" class=\"swap-item\" :showConfirmButton=\"false\" style=\"padding: 0\" :title=\"''\">\n          <div class=\"close-box flex-between\">\n            <span></span>\n            <van-icon @click=\"show=false\" name=\"cross\" color=\"#fff\" size=\"20px\"/>\n          </div>\n          <van-field\n    v-model=\"swapAmount\"\n    center\n    clearable\n    label=\"\"\n    placeholder=\"请输入买入数量\"\n  >\n    <template #extra>\n      <span class=\"sympol\">KTT</span>\n    </template>\n  </van-field>\n  <div class=\"flex-between\">\n     <div class=\"price-desc\">可买入: <span>{{orderInfo.remainAmount}}</span> KTT</div>\n    <div class=\"price-desc\">余额: <span>{{usdtBalance}}}</span> KTT</div>\n  </div>\n  \n  <div class=\"button-box\">\n    <van-button color=\"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)\" type=\"primary\" :loading=\"btn.swaploading\" size=\"large\" loading-text=\"兑换中...\" block v-if=\"Number(usdtAllowance) > 0\" @click=\"sellKtt\">卖出</van-button>\n     <van-button color=\"linear-gradient(90deg, #5161F5 0%, #64C5FA 100%)\" type=\"primary\" :loading=\"btn.swaploading\" v-else size=\"large\" loading-text=\"正在授权...\" @click=\"approveUsdt\">授权KTT</van-button>\n  </div>\n  </van-dialog>\n\n  </div>\n     </van-list>\n</template>\n<script>\nimport HeadTop from '@/components/HeadTop'\nimport { reactive, toRefs, computed, watch } from \"vue\";\nimport { useStore } from \"vuex\";\nimport { MaxUint256 } from \"@ethersproject/constants\";\nimport BigNumber from 'bignumber.js';\nimport _ from 'lodash'\nimport marketAbi from \"@/utils/marketAbi\";\nimport tokenAbi from \"@/utils/abi\";\nimport config from \"@/utils/config\";\nimport { Toast } from 'vant';\nimport dateformat from \"dateformat\"\nexport default {\n  components: {\n    HeadTop\n  },\n  setup () {\n    const store = useStore()\n    const data = reactive({\n      address: computed(() => store.state.accounts[0]),\n      web3: computed(() => store.state.provider),\n      marketContract: null,\n      usdtContract: null,\n      KttContract: null,\n      usdtAllowance: '',\n      usdtBalance: '0.00',\n      usdtAmount: '0.00',\n      kttAmount: '0.00',\n      ktmAmount: '0.00',\n      kttBalance: '0.00',\n      kttAllowance: '',\n      config: config,\n      price: '',\n       btn: {\n        loading: false,\n        swaploading: false\n      },\n      swapKttAmount: '',\n      swapAmount: '',\n      list: [],\n      show: false,\n      orderInfo: null,\n      page: 1,\n      limit: 15,\n      loading: false,\n      error: false,\n      finished: false,\n      initContract: () => {\n        data.marketContract = new data.web3.eth.Contract(marketAbi, config.sellMarketAddress)\n        data.usdtContract = new data.web3.eth.Contract(tokenAbi, config.usdtAddress)\n        data.kttContract = new data.web3.eth.Contract(tokenAbi, config.kttAddress)\n        data.initData()\n      },\n      initData: () => {\n        data.getBalance()\n        data.getUsdtAllowance()\n        data.getKttAllowance()\n        data.list = []\n        data.page = 1\n        data.getList()\n      },\n        onLoad () {\n        data.page++\n        data.getList()\n      },\n      getBalance: async () => {\n        let kttDecimals = await data.kttContract.methods.decimals().call()\n        let usdtDecimals = await data.usdtContract.methods.decimals().call()\n        let kttBalance = await data.kttContract.methods.balanceOf(data.address).call()\n        let usdtBalance = await data.usdtContract.methods.balanceOf(data.address).call()\n        data.kttBalance =  new BigNumber(kttBalance).dividedBy(10 ** kttDecimals).toFixed(2)\n        data.usdtBalance =  new BigNumber(usdtBalance).dividedBy(10 ** usdtDecimals).toFixed(2)\n      },\n      getUsdtAllowance: async () => {\n        let allowance = await data.usdtContract.methods.allowance(data.address, config.sellMarketAddress).call()\n        data.usdtAllowance = allowance;\n      },\n       getKttAllowance: async () => {\n        let allowance = await data.kttContract.methods.allowance(data.address, config.sellMarketAddress).call()\n        data.kttAllowance = allowance;\n        console.log(allowance, '-----------allowance')\n      },\n      approveUsdt: async () => {\n        data.btn.loading = true\n        try {\n          await data.usdtContract.methods.approve(config.sellMarketAddress, MaxUint256).send({from: data.address})\n          Toast('授权成功')\n          data.getUsdtAllowance()\n          data.btn.loading = false\n        } catch (error) {\n          Toast('授权失败')\n          data.btn.loading = false\n        }\n        \n      },\n      approveKtt: async () => {\n        data.btn.swaploading = true\n        try {\n          await data.kttContract.methods.approve(config.sellMarketAddress, MaxUint256).send({from: data.address})\n          Toast('授权成功')\n          data.getKttAllowance()\n          data.btn.swaploading = false\n        } catch (error) {\n          Toast('授权失败')\n          data.btn.swaploading = false\n        }\n        \n      },\n      addBuyRecord: async () => {\n        if(!data.swapKttAmount) {\n          Toast('请先输入数量')\n          return\n        }\n        if(Number(data.swapKttAmount) < 100) {\n          Toast('数量最小100')\n          return\n        }\n        if(Number(data.swapKttAmount) % 100 > 0) {\n          Toast('必须是100的整数倍')\n          return\n        }\n        if(!data.price) {\n          Toast('请先输入价格')\n          return\n        }\n        if(Number(data.swapKttAmount) > Number(data.kttBalance)) {\n          Toast('KTT余额不足')\n          return\n        }\n        \n         data.btn.loading = true\n        try {\n          let decimals = await data.kttContract.methods.decimals().call()\n          let usdtDecimals = await data.usdtContract.methods.decimals().call()\n          let amount = new BigNumber(data.swapKttAmount).multipliedBy(10 ** decimals).toFixed()\n          let price = new BigNumber(data.price).multipliedBy(10 ** usdtDecimals).toFixed()\n          await data.marketContract.methods.addBuyRecord(amount, price).send({from: data.address})\n          Toast('挂单成功')\n          data.initData()\n          data.btn.loading = false\n        } catch (error) {\n          Toast('挂单失败')\n          data.btn.loading = false\n        }\n      },\n      getList: async () => {\n        console.log(data.page,data.limit)\n        let info = await data.marketContract.methods.getUserRecords(data.page,data.limit).call({from: data.address})\n        let list = info.recordArr\n        console.log(info)\n        let arr = []\n         list.forEach((item) => {\n          console.log(item.kttAmount, item.haveSellAmount, item.isCancle)\n          if(Number(item.id) > 0 && !item.isCancle) {\n            console.log(1111)\n            arr.push({\n              kttAmount:  new BigNumber(item.kttAmount).dividedBy(10**18).toFixed(2),\n              haveSellAmount:  new BigNumber(item.haveSellAmount).dividedBy(10**18).toFixed(2),\n              price: new BigNumber(item.price).dividedBy(10**18).toFixed(2),\n              id:item.id,\n              remainAmount: new BigNumber(item.kttAmount).minus(item.haveSellAmount).dividedBy(10**18).toFixed(2),\n              isCancle: item.isCancle,\n              buyer: item.buyer\n            })\n          }\n        })\n          if (data.page === 1) {\n            data.list = arr\n          } else {\n            data.list.push(...arr)\n          }\n          data.loading = false\n          data.finished = !(Math.ceil(info.total / data.limit) > data.page)\n          if(!data.finished) {\n            data.onLoad()\n          }\n      },\n      toSell: (item) => {\n        data.show = true\n        data.orderInfo = item\n      },\n      sellKtt: async () => {\n        if(!data.swapAmount) {\n          Toast('请先输入数量')\n          return\n        }\n        if(Number(data.swapAmount * data.orderInfo.price) > Number(data.usdtBalance)) {\n          Toast('USDT余额不足')\n          return\n        }\n         data.btn.swaploading = true\n          let decimals = await data.kttContract.methods.decimals().call()\n          let amount = new BigNumber(data.swapAmount).multipliedBy(10 ** decimals).toFixed()\n        try {\n          await data.marketContract.methods.sell(data.orderInfo.id,amount).send({from: data.address})\n          Toast('买入成功')\n           data.initData()\n           data.show = false\n          data.btn.swaploading = false\n        } catch (error) {\n          Toast('买入失败')\n           data.show = false\n          data.btn.swaploading = false\n        }\n      },\n       cancle: async (id) => {\n        try {\n          await data.marketContract.methods.cancle(id).send({from: data.address})\n          Toast('取消成功')\n           data.initData()\n        } catch (error) {\n          Toast('取消失败')\n        }\n      },\n      getOutAmount: _.throttle(async function(){\n        if (!data.swapKttAmount || Number(data.swapKttAmount)  == 0 || !data.price || Number(data.price)==0) {\n          return '0.00'\n        }\n        let usdtAmount = new BigNumber(data.swapKttAmount).multipliedBy(data.price).toFixed(2)\n        data.usdtAmount = usdtAmount\n      }, 1000)\n    })\n    if (data.address) {\n      data.initContract()\n    }\n    watch(() => data.address, (val) => {\n      if (val) {\n        data.initContract()\n      }\n    })\n    const refData = toRefs(data);\n    return {\n      ...refData\n    };\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n.swap{\n  padding: 16px;\n}\n.sympol{\n    font-size: 14px;\n}\n.swap-item{\n  background: #3F2E6F;\n  border-radius: 5px;\n  padding: 20px 14px;\n  margin-bottom: 15px;\n  .title{\n    text-align: center;\n    color: #fff;\n    font-size: 16px;\n    font-weight: 600;\n    margin-bottom: 20px;\n  }\n  .price-desc{\n    font-size: 12px;\n    font-weight: 600;\n    color: #E4D7FF;\n    margin: 15px 8px;\n    span{\n      color: #FFD511;\n    }\n  }\n}\n.title-sub{\n  font-size: 16px;\n  font-weight: 700;\n  margin: 20px 0;\n  color: #fff;\n}\n  .list-box{\n    padding-top: 20px;\n    .item{\n      background: #3F2E6F;\n    box-shadow: 0px 4px 0px 0px #3F2E6F;\n    border-radius: 15px;\n    padding: 25px 20px;\n    margin-bottom: 20px;\n      .top{\n          padding-bottom: 20px;\n          border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);\n        .top-item{\n          .num{\n            color: #fff;\n            font-size: 18px;\n            font-weight: 700;\n            margin-bottom: 4px;\n          }\n          .yellow{\n            color: #FFD511;\n          }\n          .desc{\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 14px;\n          }\n        }\n        .line{\n          width: 0.5px;\n          height: 40px;\n          background: rgba(255, 255, 255, 0.1);\n          margin-right: 18px;\n        }\n      }\n      .bottom{\n        padding: 18px 0 0;\n        .status{\n          color: #0CD3DD;\n          font-size: 16px;\n          font-weight: 700;\n          padding-bottom: 4px;\n        }\n        .red{\n          color: #F3489D;\n        }\n        .row{\n          margin-top: 10px;\n          .name{\n            width: 110px;\n            color: rgba(255, 255, 255, 0.7);\n            font-size: 14px;\n          }\n          .value{\n            color: #fff;\n            font-size: 14px;\n          }\n        }\n      }\n      .btn-box{\n        margin-top: 16px;\n      }\n    }\n  }\n  .close-box{\n    margin-bottom: 20px;\n    margin-top: -6px;\n  }\n</style>\n","import { render } from \"./index.vue?vue&type=template&id=69b13cce&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=69b13cce&lang=less&scoped=true\"\n\nimport exportComponent from \"/Users/wangyouquan/priviteProject/ketai/ketai-vue/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-69b13cce\"]])\n\nexport default __exports__"],"sourceRoot":""}