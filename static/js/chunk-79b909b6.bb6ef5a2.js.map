{"version":3,"sources":["webpack:///./src/views/reward/index.vue","webpack:///./src/views/reward/index.vue?0a65","webpack:///./src/views/reward/index.vue?afcb"],"names":["class","_createElementVNode","_createElementBlock","_createVNode","_component_HeadTop","title","isShowTop","isSubHeader","_component_van_list","loading","_ctx","$event","immediate-check","error","error-text","finished","finished-text","onLoad","_Fragment","_renderList","item","index","key","_toDisplayString","stakeKttAmount","_hoisted_6","_hoisted_7","totalRewardKtm","_hoisted_10","isValid","isCanTake","_hoisted_16","lockTime","_hoisted_19","stakeTime","_hoisted_22","endTime","_hoisted_25","_component_van_button","type","style","block","onClick","id","components","HeadTop","setup","store","useStore","data","reactive","address","computed","state","accounts","web3","provider","swapContract","page","limit","list","initContract","eth","Contract","swapAbi","config","swapAddress","initData","getList","methods","getUserRewardRecords","call","from","info","periodTime","getBlockTimestamp","timestamp","records","arr","forEach","Number","push","BigNumber","dividedBy","toFixed","dayBackKtm","dateformat","Math","ceil","total","withdrawRewardStakeRecord","send","Toast","watch","val","refData","toRefs","__exports__","render"],"mappings":"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","file":"static/js/chunk-79b909b6.bb6ef5a2.js","sourcesContent":["<template>\r\n  <div class=\"swap-box invest-box\">\r\n    <HeadTop title=\"记录\" :isShowTop=\"true\" :isSubHeader=\"false\"></HeadTop>\r\n     <van-list v-model:loading=\"loading\" :immediate-check=\"false\" v-model:error=\"error\" error-text=\"请求失败，点击重新加载\" :finished=\"finished\" finished-text=\"没有更多了\" @load=\"onLoad\">\r\n    <div class=\"list-box\">\r\n       <div class=\"item\" v-for=\"(item, index) in list\" :key=\"index\">\r\n          <div class=\"top flex-middle\">\r\n            <div class=\"top-item flex-item\">\r\n               <div class=\"num\">{{item.stakeKttAmount}}</div>\r\n               <div class=\"desc\">质押KTT</div>\r\n            </div>\r\n            <div class=\"line\"></div>\r\n            <div class=\"top-item flex-item\">\r\n               <div class=\"num yellow\">{{item.totalRewardKtm}}</div>\r\n               <div class=\"desc\">KTM总收益</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"bottom\">\r\n            \r\n            <div class=\"status\" v-if=\"!item.isValid\">已领取</div>\r\n             <div class=\"status\" v-else-if=\"item.isCanTake\">可领取</div>\r\n             <div class=\"status red\" v-else>{{$t('未到期')}}</div>\r\n             <div class=\"row flex-middle\">\r\n                <div class=\"name\">时长</div>\r\n                <div class=\"value\">{{item.lockTime}}天</div>\r\n             </div>\r\n             <div class=\"row flex-middle\">\r\n                <div class=\"name\">质押时间</div>\r\n                <div class=\"value\">{{item.stakeTime}}</div>\r\n             </div>\r\n             <div class=\"row flex-middle\">\r\n                <div class=\"name\">质押到期时间</div>\r\n                <div class=\"value\">{{item.endTime}}</div>\r\n             </div>\r\n          </div>\r\n           <div class=\"btn-box flex-between\" v-if=\"item.isCanTake && item.isValid\">\r\n               <span></span>\r\n                <van-button type=\"primary\" class=\"btn-green\" style=\"width: 120px\" block @click=\"withdrawRewardStakeRecord(item.id)\">领取</van-button>\r\n           </div>\r\n       </div>\r\n    </div>\r\n    </van-list>\r\n  </div>  \r\n</template>\r\n<script>\r\nimport HeadTop from '@/components/HeadTop'\r\nimport { reactive, toRefs, computed, watch } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport swapAbi from \"@/utils/swapAbi\";\r\nimport { Toast } from 'vant';\r\nimport config from \"@/utils/config\";\r\nimport BigNumber from 'bignumber.js';\r\nimport dateformat from \"dateformat\"\r\nexport default {\r\n  components: {\r\n    HeadTop\r\n  },\r\n  setup () {\r\n    const store = useStore()\r\n    const data = reactive({\r\n      address: computed(() => store.state.accounts[0]),\r\n      web3: computed(() => store.state.provider),\r\n      swapContract: null,\r\n      page: 1,\r\n      limit: 5,\r\n      loading: false,\r\n      error: false,\r\n      finished: false,\r\n      list: [],\r\n      initContract: () => {\r\n        data.swapContract = new data.web3.eth.Contract(swapAbi, config.swapAddress)\r\n        data.initData()\r\n      },\r\n      initData: () => {\r\n         data.list = []\r\n        data.page = 1\r\n        data.getList()\r\n      },\r\n        onLoad () {\r\n        data.page++\r\n        data.getList()\r\n      },\r\n      getList: async () => {\r\n        let info = await data.swapContract.methods.getUserRewardRecords(data.address,1,5).call({from: data.address})\r\n        let periodTime = await data.swapContract.methods.periodTime().call()\r\n        let timestamp = await data.swapContract.methods.getBlockTimestamp().call()\r\n        let list = info.records\r\n        let arr = []\r\n         list.forEach((item) => {\r\n          if(Number(item.id) > 0) {\r\n            arr.push({\r\n              stakeKttAmount:  new BigNumber(item.stakeKttAmount).dividedBy(10**18).toFixed(2),\r\n              totalRewardKtm:  new BigNumber(item.totalRewardKtm).dividedBy(10**18).toFixed(2),\r\n              dayBackKtm: new BigNumber(item.dayBackKtm).dividedBy(10**18).toFixed(2),\r\n              id:item.id,\r\n              isValid: item.isValid,\r\n              lockTime: new BigNumber(item.lockTime).dividedBy(periodTime).toFixed(1),\r\n              stakeTime: dateformat(item.stakeTime*1000, 'yyyy-mm-dd HH:MM:ss'),\r\n              endTime: dateformat((Number(item.stakeTime) + Number(item.lockTime))*1000, 'yyyy-mm-dd HH:MM:ss'),\r\n              isCanTake: Number(timestamp) >= Number(item.stakeTime) + Number(item.lockTime)\r\n            })\r\n          }\r\n        })\r\n          if (data.page === 1) {\r\n            data.list = arr\r\n          } else {\r\n            data.list.push(...arr)\r\n          }\r\n          data.loading = false\r\n          data.finished = !(Math.ceil(info.total / data.limit) > data.page)\r\n      },\r\n      withdrawRewardStakeRecord: async (id) => {\r\n        try {\r\n          await data.swapContract.methods.withdrawRewardStakeRecord(id).send({from: data.address})\r\n          Toast('领取成功')\r\n        } catch (error) {\r\n          Toast('领取失败')  \r\n        }\r\n        \r\n      } \r\n    })\r\n    if (data.address) {\r\n      data.initContract()\r\n    }\r\n    watch(() => data.address, (val) => {\r\n      if (val) {\r\n        data.initContract()\r\n      }\r\n    })\r\n    const refData = toRefs(data);\r\n    return {\r\n      ...refData\r\n    };\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.invest-box{\r\n  padding: 10px 16px 25px;\r\n  .list-box{\r\n    padding-top: 20px;\r\n    .item{\r\n      background: #3F2E6F;\r\n    box-shadow: 0px 4px 0px 0px #3F2E6F;\r\n    border-radius: 15px;\r\n    padding: 25px 20px;\r\n    margin-bottom: 20px;\r\n      .top{\r\n          padding-bottom: 20px;\r\n          border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);\r\n        .top-item{\r\n          .num{\r\n            color: #fff;\r\n            font-size: 18px;\r\n            font-weight: 700;\r\n            margin-bottom: 4px;\r\n          }\r\n          .yellow{\r\n            color: #FFD511;\r\n          }\r\n          .desc{\r\n            color: rgba(255, 255, 255, 0.7);\r\n            font-size: 14px;\r\n          }\r\n        }\r\n        .line{\r\n          width: 0.5px;\r\n          height: 40px;\r\n          background: rgba(255, 255, 255, 0.1);\r\n          margin-right: 18px;\r\n        }\r\n      }\r\n      .bottom{\r\n        padding: 18px 0 0;\r\n        .status{\r\n          color: #0CD3DD;\r\n          font-size: 16px;\r\n          font-weight: 700;\r\n          padding-bottom: 4px;\r\n        }\r\n        .red{\r\n          color: #F3489D;\r\n        }\r\n        .row{\r\n          margin-top: 10px;\r\n          .name{\r\n            width: 110px;\r\n            color: rgba(255, 255, 255, 0.7);\r\n            font-size: 14px;\r\n          }\r\n          .value{\r\n            color: #fff;\r\n            font-size: 14px;\r\n          }\r\n        }\r\n      }\r\n      .btn-box{\r\n        margin-top: 16px;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./index.vue?vue&type=template&id=06fe9b5a&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=06fe9b5a&lang=less&scoped=true\"\n\nimport exportComponent from \"F:\\\\activeSelf\\\\ketai_vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-06fe9b5a\"]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=06fe9b5a&lang=less&scoped=true\""],"sourceRoot":""}